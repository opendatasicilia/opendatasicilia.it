{
    "componentChunkName": "component---src-templates-tag-js",
    "path": "/tag/bash",
    "result": {"data":{"allWpPost":{"nodes":[{"title":"I dati di soldipubblici.gov.it sul tuo portale open data","slug":"i-dati-di-soldipubblici-gov-it-sul-tuo-portale-open-data","uri":"/2018/04/27/i-dati-di-soldipubblici-gov-it-sul-tuo-portale-open-data/","excerpt":"<p>I portali open data hanno sempre bisogno di essere alimentati con dataset nuovi e soprattutto aggiornati.  Attivare quei meccanismi che consentono di generare file aperti e allo stesso aggiornati, nella Pubblica Amministrazione, è un processo che molte volte richiede tempo e soprattutto un cambio di mentalità; è un discorso questo, che si sente spesso nella [&hellip;]</p>\n<div class=\"sharedaddy sd-sharing-enabled\"><div class=\"robots-nocontent sd-block sd-social sd-social-icon sd-sharing\"><h3 class=\"sd-title\">Condividi:</h3><div class=\"sd-content\"><ul><li class=\"share-twitter\"><a rel=\"nofollow noopener noreferrer\" data-shared=\"sharing-twitter-1771\" class=\"share-twitter sd-button share-icon no-text\" href=\"/2018/04/27/i-dati-di-soldipubblici-gov-it-sul-tuo-portale-open-data/?share=twitter\" target=\"_blank\" title=\"Fai clic qui per condividere su Twitter\"><span></span><span class=\"sharing-screen-reader-text\">Fai clic qui per condividere su Twitter (Si apre in una nuova finestra)</span></a></li><li class=\"share-facebook\"><a rel=\"nofollow noopener noreferrer\" data-shared=\"sharing-facebook-1771\" class=\"share-facebook sd-button share-icon no-text\" href=\"/2018/04/27/i-dati-di-soldipubblici-gov-it-sul-tuo-portale-open-data/?share=facebook\" target=\"_blank\" title=\"Fai clic per condividere su Facebook\"><span></span><span class=\"sharing-screen-reader-text\">Fai clic per condividere su Facebook (Si apre in una nuova finestra)</span></a></li><li><a href=\"#\" class=\"sharing-anchor sd-button share-more\"><span>Altro</span></a></li><li class=\"share-end\"></li></ul><div class=\"sharing-hidden\"><div class=\"inner\" style=\"display: none;\"><ul><li class=\"share-linkedin\"><a rel=\"nofollow noopener noreferrer\" data-shared=\"sharing-linkedin-1771\" class=\"share-linkedin sd-button share-icon no-text\" href=\"/2018/04/27/i-dati-di-soldipubblici-gov-it-sul-tuo-portale-open-data/?share=linkedin\" target=\"_blank\" title=\"Fai clic qui per condividere su LinkedIn\"><span></span><span class=\"sharing-screen-reader-text\">Fai clic qui per condividere su LinkedIn (Si apre in una nuova finestra)</span></a></li><li class=\"share-telegram\"><a rel=\"nofollow noopener noreferrer\" data-shared=\"\" class=\"share-telegram sd-button share-icon no-text\" href=\"/2018/04/27/i-dati-di-soldipubblici-gov-it-sul-tuo-portale-open-data/?share=telegram\" target=\"_blank\" title=\"Fai clic per condividere su Telegram\"><span></span><span class=\"sharing-screen-reader-text\">Fai clic per condividere su Telegram (Si apre in una nuova finestra)</span></a></li><li class=\"share-end\"></li><li class=\"share-jetpack-whatsapp\"><a rel=\"nofollow noopener noreferrer\" data-shared=\"\" class=\"share-jetpack-whatsapp sd-button share-icon no-text\" href=\"/2018/04/27/i-dati-di-soldipubblici-gov-it-sul-tuo-portale-open-data/?share=jetpack-whatsapp\" target=\"_blank\" title=\"Fai clic per condividere su WhatsApp\"><span></span><span class=\"sharing-screen-reader-text\">Fai clic per condividere su WhatsApp (Si apre in una nuova finestra)</span></a></li><li class=\"share-end\"></li></ul></div></div></div></div></div>","content":"<p>I portali open data hanno sempre bisogno di essere alimentati con dataset nuovi e soprattutto aggiornati.  Attivare quei meccanismi che consentono di generare file aperti e allo stesso aggiornati, nella Pubblica Amministrazione, è un processo che molte volte richiede tempo e soprattutto un cambio di mentalità; è un discorso questo, che si sente spesso nella PA.</p>\n<p>La comunità di opendatasicilia mi ha spesso insegnato che, è mostrando la potenzialità dei dati aperti con il riuso, che quei meccanismi di interesse si possono sbloccare, attirando nuove idee e nuovi dati. Avere quindi dati aperti, aggiornati e attendibili, è cosa rara e complicata, ma quando ne puoi <a href=\"https://groups.google.com/d/msg/opendatasicilia/nzpMl2pXZqs/JulkbiDCCAAJ\">discutere un po’ in gruppo</a> e alimentare le tue fantasie e le tue idee con uno script di poche righe ma efficientissimo, allora la vita sembra prendere una piega del tutto diversa!</p>\n<p>Sotto la spinta delle mie esigenze lo script (creato da <a href=\"https://twitter.com/aborruso/\">Andrea Borruso</a>), originariamente nato per scaricare i dati di un singolo ente da <a href=\"http://soldipubblici.gov.it/\">soldipubblici.gov.it</a>, ha consentito la pubblicazione di una dataset sul portale open data della <a href=\"http://dati.cittametropolitana.na.it/dataset/soldipubblici-spese-correnti-della-citta-metropolitana-di-napoli\">Città Metropolitana di Napoli</a>, in due formati (csv e json), con aggiornamento automatico settimanale.</p>\n<p>Ma andiamo per gradi.<br />\nIl sito <a href=\"http://soldipubblici.gov.it/\">soldipubblici.gov.it</a> consente  di consultare e scaricare  i dati della spesa pubblica  ricercando un ente.</p>\n<p><img loading=\"lazy\" class=\"size-full wp-image-1773 alignnone\" src=\"https://i2.wp.com/opendatasicilia.it/wp-content/uploads/2018/04/soldipubblici.png?resize=1005%2C512&#038;ssl=1\" alt=\"\" width=\"1005\" height=\"512\" srcset=\"https://i2.wp.com/opendatasicilia.it/wp-content/uploads/2018/04/soldipubblici.png?w=1005&amp;ssl=1 1005w, https://i2.wp.com/opendatasicilia.it/wp-content/uploads/2018/04/soldipubblici.png?resize=300%2C153&amp;ssl=1 300w, https://i2.wp.com/opendatasicilia.it/wp-content/uploads/2018/04/soldipubblici.png?resize=768%2C391&amp;ssl=1 768w\" sizes=\"(max-width: 1005px) 100vw, 1005px\" data-recalc-dims=\"1\" /></p>\n<p>È possibile fare il download del CSV, al click su un pulsante, ma nel mio caso avevo bisogno di automatizzare questo processo.</p>\n<p>Lo script (accessibile <a href=\"https://gist.github.com/pablopers/a10e86987b2968f7460b21616842106f#file-gistfile1-txt-L36\">qui</a>) è scritto in bash, sfrutta le <em>utility</em> <a href=\"https://httpie.org/\">httpie</a>, <a href=\"https://stedolan.github.io/jq/\">jq</a> e <a href=\"https://csvkit.readthedocs.io\">csvkit</a> e funziona in questo modo:</p>\n<ul>\n<li>si imposta il codice dell’ente di interesse (i codici dei vari enti si trovano <a href=\"http://soldipubblici.gov.it/data/Siope-anagrafiche.zip\">qui</a>)</li>\n<li>il dato viene scaricato in formato JSON, e le cifre spese espresse in origine come numero intero (è stata rimossa la parte decimale, moltiplicando per 100), vengono riportate a numero decimale;</li>\n<li>il file così trasformato viene salvato in JSON e CSV.</li>\n</ul>\n<p>Alla versione originale dello script <a href=\"https://groups.google.com/d/msg/opendatasicilia/nzpMl2pXZqs/l9_1iSWGCgAJ\">volevo aggiungere</a> la possibilità di rimuovere quei record in cui le colonne con i valori numerici sono non valorizzate (sono “<i>null</i>”). E allora mi è stato suggerito di usare <a href=\"https://csvkit.readthedocs.io/en/1.0.3/scripts/csvgrep.html\">csvgrep</a>, che può filtrare le righe di una tabella a partire da un’espressione regolare ed è stata aggiunta la riga:</p>\n<pre class=\"\"><./input.csv csvgrep -c \"imp_uscite_att,importo_2013,importo_2014,importo_2015,importo_2016,importo_2017\" -r \"^$\" -i >./output.csv</pre>\n<p>Lo script viene eseguito su un server del mio Ente, e l’output è accessibile dall’esterno pubblicamente in http.</p>\n<p>Essendo i dati di “soldipubblici” aggiornati settimanalmente, nasceva infine l’esigenza di doverne automatizzare il download senza la necessità di un intervento umano. Così, sempre su indicazioni apprese nello scambio in mailing list, ho modificato il file /etc/crontab (che negli ambienti Linux consente di impostare delle operazioni da eseguire in modo pianificato) aggiungendo:</p>\n<pre class=\"\">0 4 */7 * * root /var/progetti/soldipubblici/getspscript.sh > /dev/null 2&1</pre>\n<p>La stringa “0 4 */7 * *” corrisponde a “<a href=\"https://crontab.guru/#0_4_*/7_*_*\">ogni 7 giorni alle 4 di mattina</a>”.</p>\n<p>Verificato che il tutto funzionasse correttamente e ottenuti i link statici dei file creati dallo script, ho provveduto a caricarli in un dataset sul portale ckan degli Open Data della Città Metropolitana di Napoli.</p>\n<p><img loading=\"lazy\" class=\"aligncenter size-full wp-image-1772\" src=\"https://i1.wp.com/opendatasicilia.it/wp-content/uploads/2018/04/portaleOpenDataCittaMetropolitanaNapoli.png?resize=946%2C732&#038;ssl=1\" alt=\"\" width=\"946\" height=\"732\" srcset=\"https://i1.wp.com/opendatasicilia.it/wp-content/uploads/2018/04/portaleOpenDataCittaMetropolitanaNapoli.png?w=946&amp;ssl=1 946w, https://i1.wp.com/opendatasicilia.it/wp-content/uploads/2018/04/portaleOpenDataCittaMetropolitanaNapoli.png?resize=300%2C232&amp;ssl=1 300w, https://i1.wp.com/opendatasicilia.it/wp-content/uploads/2018/04/portaleOpenDataCittaMetropolitanaNapoli.png?resize=768%2C594&amp;ssl=1 768w\" sizes=\"(max-width: 946px) 100vw, 946px\" data-recalc-dims=\"1\" /></p>\n<p>È nato così il primo caso d’uso specifico dello script SpesaCron, dove grazie all’estrazione di due file csv e json dai dati di <a href=\"http://soldipubblici.gov.it/\">soldipubblici.gov.it</a> è stato possibile pubblicare un dataset contenente tutte le voci di spesa di una Pubblica Amministrazione, automaticamente alimentato dallo stesso sito e con frequenza di aggiornamento settimanale.</p>\n<div class=\"sharedaddy sd-sharing-enabled\"><div class=\"robots-nocontent sd-block sd-social sd-social-icon sd-sharing\"><h3 class=\"sd-title\">Condividi:</h3><div class=\"sd-content\"><ul><li class=\"share-twitter\"><a rel=\"nofollow noopener noreferrer\" data-shared=\"sharing-twitter-1771\" class=\"share-twitter sd-button share-icon no-text\" href=\"/2018/04/27/i-dati-di-soldipubblici-gov-it-sul-tuo-portale-open-data/?share=twitter\" target=\"_blank\" title=\"Fai clic qui per condividere su Twitter\"><span></span><span class=\"sharing-screen-reader-text\">Fai clic qui per condividere su Twitter (Si apre in una nuova finestra)</span></a></li><li class=\"share-facebook\"><a rel=\"nofollow noopener noreferrer\" data-shared=\"sharing-facebook-1771\" class=\"share-facebook sd-button share-icon no-text\" href=\"/2018/04/27/i-dati-di-soldipubblici-gov-it-sul-tuo-portale-open-data/?share=facebook\" target=\"_blank\" title=\"Fai clic per condividere su Facebook\"><span></span><span class=\"sharing-screen-reader-text\">Fai clic per condividere su Facebook (Si apre in una nuova finestra)</span></a></li><li><a href=\"#\" class=\"sharing-anchor sd-button share-more\"><span>Altro</span></a></li><li class=\"share-end\"></li></ul><div class=\"sharing-hidden\"><div class=\"inner\" style=\"display: none;\"><ul><li class=\"share-linkedin\"><a rel=\"nofollow noopener noreferrer\" data-shared=\"sharing-linkedin-1771\" class=\"share-linkedin sd-button share-icon no-text\" href=\"/2018/04/27/i-dati-di-soldipubblici-gov-it-sul-tuo-portale-open-data/?share=linkedin\" target=\"_blank\" title=\"Fai clic qui per condividere su LinkedIn\"><span></span><span class=\"sharing-screen-reader-text\">Fai clic qui per condividere su LinkedIn (Si apre in una nuova finestra)</span></a></li><li class=\"share-telegram\"><a rel=\"nofollow noopener noreferrer\" data-shared=\"\" class=\"share-telegram sd-button share-icon no-text\" href=\"/2018/04/27/i-dati-di-soldipubblici-gov-it-sul-tuo-portale-open-data/?share=telegram\" target=\"_blank\" title=\"Fai clic per condividere su Telegram\"><span></span><span class=\"sharing-screen-reader-text\">Fai clic per condividere su Telegram (Si apre in una nuova finestra)</span></a></li><li class=\"share-end\"></li><li class=\"share-jetpack-whatsapp\"><a rel=\"nofollow noopener noreferrer\" data-shared=\"\" class=\"share-jetpack-whatsapp sd-button share-icon no-text\" href=\"/2018/04/27/i-dati-di-soldipubblici-gov-it-sul-tuo-portale-open-data/?share=jetpack-whatsapp\" target=\"_blank\" title=\"Fai clic per condividere su WhatsApp\"><span></span><span class=\"sharing-screen-reader-text\">Fai clic per condividere su WhatsApp (Si apre in una nuova finestra)</span></a></li><li class=\"share-end\"></li></ul></div></div></div></div></div>","date":"2018-04-27T08:15:16","author":{"node":{"name":"Pablo Persico","slug":"ppersico"}},"comments":{"nodes":[{"content":"<p>[&#8230;] I dati di soldipubblici.gov.it sul tuo portale open data [&#8230;]</p>\n"}]},"categories":{"nodes":[{"name":"Dati","slug":"dati"},{"name":"tools","slug":"tools"}]},"tags":{"nodes":[{"name":"bash","slug":"bash"},{"name":"script","slug":"script"}]},"featuredImage":null},{"title":"Leggere, interrogare e trasformare file XML da riga di comando","slug":"leggere-interrogare-e-trasformare-file-xml-da-riga-di-comando","uri":"/2017/06/16/leggere-interrogare-e-trasformare-file-xml-da-riga-di-comando/","excerpt":"<p>Intro Il comune di Palermo ha pubblicato i dati pubblici e aperti sulle elezioni comunali dell&#8217;11 giugno 2017 in formato XML, con uno schema descritto in questo file. Qui sotto ad esempio la struttura di uno degli oltre 200 file pubblicati. L&#8217;XML è uno dei formati classici di pubblicazione di dati aperti, ma non è un formato per [&hellip;]</p>\n<div class=\"sharedaddy sd-sharing-enabled\"><div class=\"robots-nocontent sd-block sd-social sd-social-icon sd-sharing\"><h3 class=\"sd-title\">Condividi:</h3><div class=\"sd-content\"><ul><li class=\"share-twitter\"><a rel=\"nofollow noopener noreferrer\" data-shared=\"sharing-twitter-1686\" class=\"share-twitter sd-button share-icon no-text\" href=\"/2017/06/16/leggere-interrogare-e-trasformare-file-xml-da-riga-di-comando/?share=twitter\" target=\"_blank\" title=\"Fai clic qui per condividere su Twitter\"><span></span><span class=\"sharing-screen-reader-text\">Fai clic qui per condividere su Twitter (Si apre in una nuova finestra)</span></a></li><li class=\"share-facebook\"><a rel=\"nofollow noopener noreferrer\" data-shared=\"sharing-facebook-1686\" class=\"share-facebook sd-button share-icon no-text\" href=\"/2017/06/16/leggere-interrogare-e-trasformare-file-xml-da-riga-di-comando/?share=facebook\" target=\"_blank\" title=\"Fai clic per condividere su Facebook\"><span></span><span class=\"sharing-screen-reader-text\">Fai clic per condividere su Facebook (Si apre in una nuova finestra)</span></a></li><li><a href=\"#\" class=\"sharing-anchor sd-button share-more\"><span>Altro</span></a></li><li class=\"share-end\"></li></ul><div class=\"sharing-hidden\"><div class=\"inner\" style=\"display: none;\"><ul><li class=\"share-linkedin\"><a rel=\"nofollow noopener noreferrer\" data-shared=\"sharing-linkedin-1686\" class=\"share-linkedin sd-button share-icon no-text\" href=\"/2017/06/16/leggere-interrogare-e-trasformare-file-xml-da-riga-di-comando/?share=linkedin\" target=\"_blank\" title=\"Fai clic qui per condividere su LinkedIn\"><span></span><span class=\"sharing-screen-reader-text\">Fai clic qui per condividere su LinkedIn (Si apre in una nuova finestra)</span></a></li><li class=\"share-telegram\"><a rel=\"nofollow noopener noreferrer\" data-shared=\"\" class=\"share-telegram sd-button share-icon no-text\" href=\"/2017/06/16/leggere-interrogare-e-trasformare-file-xml-da-riga-di-comando/?share=telegram\" target=\"_blank\" title=\"Fai clic per condividere su Telegram\"><span></span><span class=\"sharing-screen-reader-text\">Fai clic per condividere su Telegram (Si apre in una nuova finestra)</span></a></li><li class=\"share-end\"></li><li class=\"share-jetpack-whatsapp\"><a rel=\"nofollow noopener noreferrer\" data-shared=\"\" class=\"share-jetpack-whatsapp sd-button share-icon no-text\" href=\"/2017/06/16/leggere-interrogare-e-trasformare-file-xml-da-riga-di-comando/?share=jetpack-whatsapp\" target=\"_blank\" title=\"Fai clic per condividere su WhatsApp\"><span></span><span class=\"sharing-screen-reader-text\">Fai clic per condividere su WhatsApp (Si apre in una nuova finestra)</span></a></li><li class=\"share-end\"></li></ul></div></div></div></div></div>","content":"<h1 id=\"intro\">Intro</h1>\n<p>Il comune di Palermo ha pubblicato i <a href=\"https://docs.google.com/spreadsheets/d/1gKrvPb82AAIi0lA_vJGdAhm0fd-Fp_hC5MiFhjhjbp8/edit?usp=sharing\">dati pubblici e aperti</a> sulle elezioni comunali dell&#8217;11 giugno 2017 in formato <code>XML</code>, con uno schema descritto in <a href=\"https://www.comune.palermo.it/js/server/uploads/opendata/MetaDatiElezioniAmministrative.pdf\">questo file</a>.</p>\n<p>Qui sotto ad esempio la struttura di uno degli oltre 200 file pubblicati.</p>\n<p><img class=\"aligncenter\" src=\"https://i2.wp.com/i.imgur.com/yvtRPCD.png?w=1140\" alt=\"\" data-recalc-dims=\"1\" /></p>\n<p>L&#8217;<code>XML</code> è uno dei formati classici di pubblicazione di dati aperti, ma non è un formato per tutti. Molti utenti infatti non sono in grado di esaminarli.<br />\nPer la sua natura è facilmente leggibile da un calcolatore e ci sono varie modalità per farlo.</p>\n<p>E con un&#8217;<em>utility</em> specializzata (XMLStarlet) e con un piccolo comando come questo di sotto, è possibile trasformare <a href=\"http://comunali2017.comune.palermo.it/SEZ_3_82053_L12.xml\">questo</a> file XML in una &#8220;piatta&#8221; tabella con tutti i dati sui voti dei candidati di una lista al consiglio comunale, per ogni sezione elettorale (40 candidati per 600 sezioni, quindi 24000 record).</p>\n<div class=\"line\"><span class=\"syntax--source syntax--shell\">xmlstarlet sel &#8211;net -t -m <span class=\"syntax--string syntax--quoted syntax--double syntax--shell\"><span class=\"syntax--punctuation syntax--definition syntax--string syntax--begin syntax--shell\">&#8220;</span>//SV/V0/V1<span class=\"syntax--punctuation syntax--definition syntax--string syntax--end syntax--shell\">&#8220;</span></span> -v <span class=\"syntax--string syntax--quoted syntax--double syntax--shell\"><span class=\"syntax--punctuation syntax--definition syntax--string syntax--begin syntax--shell\">&#8220;</span>@NUMERO<span class=\"syntax--punctuation syntax--definition syntax--string syntax--end syntax--shell\">&#8220;</span></span> -o <span class=\"syntax--string syntax--quoted syntax--double syntax--shell\"><span class=\"syntax--punctuation syntax--definition syntax--string syntax--begin syntax--shell\">&#8220;</span>,<span class=\"syntax--punctuation syntax--definition syntax--string syntax--end syntax--shell\">&#8220;</span></span> \\</span></div>\n<div class=\"line\"><span class=\"syntax--source syntax--shell\">-v <span class=\"syntax--string syntax--quoted syntax--double syntax--shell\"><span class=\"syntax--punctuation syntax--definition syntax--string syntax--begin syntax--shell\">&#8220;</span>@VOTIVALIDI_C1<span class=\"syntax--punctuation syntax--definition syntax--string syntax--end syntax--shell\">&#8220;</span></span> -o <span class=\"syntax--string syntax--quoted syntax--double syntax--shell\"><span class=\"syntax--punctuation syntax--definition syntax--string syntax--begin syntax--shell\">&#8220;</span>,<span class=\"syntax--punctuation syntax--definition syntax--string syntax--end syntax--shell\">&#8220;</span></span>  -v <span class=\"syntax--string syntax--quoted syntax--double syntax--shell\"><span class=\"syntax--punctuation syntax--definition syntax--string syntax--begin syntax--shell\">&#8220;</span>../@NUMERO<span class=\"syntax--punctuation syntax--definition syntax--string syntax--end syntax--shell\">&#8220;</span></span> -o <span class=\"syntax--string syntax--quoted syntax--double syntax--shell\"><span class=\"syntax--punctuation syntax--definition syntax--string syntax--begin syntax--shell\">&#8220;</span>,<span class=\"syntax--punctuation syntax--definition syntax--string syntax--end syntax--shell\">&#8220;</span></span> \\</span></div>\n<div class=\"line\"><span class=\"syntax--source syntax--shell\">-v <span class=\"syntax--string syntax--quoted syntax--double syntax--shell\"><span class=\"syntax--punctuation syntax--definition syntax--string syntax--begin syntax--shell\">&#8220;</span>../../@NUMERO<span class=\"syntax--punctuation syntax--definition syntax--string syntax--end syntax--shell\">&#8220;</span></span> -n \\</span></div>\n<div class=\"line\"><span class=\"syntax--source syntax--shell\">http://comunali2017.comune.palermo.it/SEZ_3_82053_L12.xml</span></div>\n<p>&nbsp;</p>\n<p>Qui sotto lo vedete in azione:</p>\n<p><img class=\"aligncenter\" src=\"https://i1.wp.com/media.giphy.com/media/wabofHvckuI5a/giphy.gif?w=1140&#038;ssl=1\" alt=\"\" data-recalc-dims=\"1\" /></p>\n<p>I dati sui risultati delle liste elettorali hanno questa struttura:</p>\n<div class=\"line\"><span class=\"syntax--text syntax--xml\"><span class=\"syntax--meta syntax--tag syntax--xml\"><span class=\"syntax--punctuation syntax--definition syntax--tag syntax--xml\">&lt;</span><span class=\"syntax--entity syntax--name syntax--tag syntax--localname syntax--xml\">SV</span> <span class=\"syntax--entity syntax--other syntax--attribute-name syntax--localname syntax--xml\">NUMERO</span>=<span class=\"syntax--string syntax--quoted syntax--double syntax--xml\"><span class=\"syntax--punctuation syntax--definition syntax--string syntax--begin syntax--xml\">&#8220;</span>1<span class=\"syntax--punctuation syntax--definition syntax--string syntax--end syntax--xml\">&#8220;</span></span> <span class=\"syntax--entity syntax--other syntax--attribute-name syntax--localname syntax--xml\">NOME</span>=<span class=\"syntax--string syntax--quoted syntax--double syntax--xml\"><span class=\"syntax--punctuation syntax--definition syntax--string syntax--begin syntax--xml\">&#8220;</span>SEZIONE 1<span class=\"syntax--punctuation syntax--definition syntax--string syntax--end syntax--xml\">&#8220;</span></span> <span class=\"syntax--entity syntax--other syntax--attribute-name syntax--localname syntax--xml\">NOMEBREVE</span>=<span class=\"syntax--string syntax--quoted syntax--double syntax--xml\"><span class=\"syntax--punctuation syntax--definition syntax--string syntax--begin syntax--xml\">&#8220;</span>SEZ. 1<span class=\"syntax--punctuation syntax--definition syntax--string syntax--end syntax--xml\">&#8220;</span></span> <span class=\"syntax--entity syntax--other syntax--attribute-name syntax--localname syntax--xml\">UBICAZIONE</span>=<span class=\"syntax--string syntax--quoted syntax--double syntax--xml\"><span class=\"syntax--punctuation syntax--definition syntax--string syntax--begin syntax--xml\">&#8220;</span><span class=\"syntax--punctuation syntax--definition syntax--string syntax--end syntax--xml\">&#8220;</span></span> <span class=\"syntax--entity syntax--other syntax--attribute-name syntax--localname syntax--xml\">NUM_ZONA</span>=<span class=\"syntax--string syntax--quoted syntax--double syntax--xml\"><span class=\"syntax--punctuation syntax--definition syntax--string syntax--begin syntax--xml\">&#8220;</span><span class=\"syntax--punctuation syntax--definition syntax--string syntax--end syntax--xml\">&#8220;</span></span> <span class=\"syntax--entity syntax--other syntax--attribute-name syntax--localname syntax--xml\">NUM_ZONA2</span>=<span class=\"syntax--string syntax--quoted syntax--double syntax--xml\"><span class=\"syntax--punctuation syntax--definition syntax--string syntax--begin syntax--xml\">&#8220;</span><span class=\"syntax--punctuation syntax--definition syntax--string syntax--end syntax--xml\">&#8220;</span></span> <span class=\"syntax--entity syntax--other syntax--attribute-name syntax--localname syntax--xml\">TOTVOT</span>=<span class=\"syntax--string syntax--quoted syntax--double syntax--xml\"><span class=\"syntax--punctuation syntax--definition syntax--string syntax--begin syntax--xml\">&#8220;</span>540<span class=\"syntax--punctuation syntax--definition syntax--string syntax--end syntax--xml\">&#8220;</span></span> <span class=\"syntax--entity syntax--other syntax--attribute-name syntax--localname syntax--xml\">TOTVOTM</span>=<span class=\"syntax--string syntax--quoted syntax--double syntax--xml\"><span class=\"syntax--punctuation syntax--definition syntax--string syntax--begin syntax--xml\">&#8220;</span>255<span class=\"syntax--punctuation syntax--definition syntax--string syntax--end syntax--xml\">&#8220;</span></span> <span class=\"syntax--entity syntax--other syntax--attribute-name syntax--localname syntax--xml\">TOTVOTF</span>=<span class=\"syntax--string syntax--quoted syntax--double syntax--xml\"><span class=\"syntax--punctuation syntax--definition syntax--string syntax--begin syntax--xml\">&#8220;</span>285<span class=\"syntax--punctuation syntax--definition syntax--string syntax--end syntax--xml\">&#8220;</span></span> <span class=\"syntax--entity syntax--other syntax--attribute-name syntax--localname syntax--xml\">FLZEROVOT</span>=<span class=\"syntax--string syntax--quoted syntax--double syntax--xml\"><span class=\"syntax--punctuation syntax--definition syntax--string syntax--begin syntax--xml\">&#8220;</span>N<span class=\"syntax--punctuation syntax--definition syntax--string syntax--end syntax--xml\">&#8220;</span></span> <span class=\"syntax--entity syntax--other syntax--attribute-name syntax--localname syntax--xml\">ELETTORI</span>=<span class=\"syntax--string syntax--quoted syntax--double syntax--xml\"><span class=\"syntax--punctuation syntax--definition syntax--string syntax--begin syntax--xml\">&#8220;</span>1112<span class=\"syntax--punctuation syntax--definition syntax--string syntax--end syntax--xml\">&#8220;</span></span> <span class=\"syntax--entity syntax--other syntax--attribute-name syntax--localname syntax--xml\">ELETTORIM</span>=<span class=\"syntax--string syntax--quoted syntax--double syntax--xml\"><span class=\"syntax--punctuation syntax--definition syntax--string syntax--begin syntax--xml\">&#8220;</span>556<span class=\"syntax--punctuation syntax--definition syntax--string syntax--end syntax--xml\">&#8220;</span></span> <span class=\"syntax--entity syntax--other syntax--attribute-name syntax--localname syntax--xml\">ELETTORIF</span>=<span class=\"syntax--string syntax--quoted syntax--double syntax--xml\"><span class=\"syntax--punctuation syntax--definition syntax--string syntax--begin syntax--xml\">&#8220;</span>556<span class=\"syntax--punctuation syntax--definition syntax--string syntax--end syntax--xml\">&#8220;</span></span> <span class=\"syntax--entity syntax--other syntax--attribute-name syntax--localname syntax--xml\">CONFERMATO</span>=<span class=\"syntax--string syntax--quoted syntax--double syntax--xml\"><span class=\"syntax--punctuation syntax--definition syntax--string syntax--begin syntax--xml\">&#8220;</span>S<span class=\"syntax--punctuation syntax--definition syntax--string syntax--end syntax--xml\">&#8220;</span></span> <span class=\"syntax--entity syntax--other syntax--attribute-name syntax--localname syntax--xml\">VOTIVALIDI_C0</span>=<span class=\"syntax--string syntax--quoted syntax--double syntax--xml\"><span class=\"syntax--punctuation syntax--definition syntax--string syntax--begin syntax--xml\">&#8220;</span>54<span class=\"syntax--punctuation syntax--definition syntax--string syntax--end syntax--xml\">&#8220;</span></span> <span class=\"syntax--entity syntax--other syntax--attribute-name syntax--localname syntax--xml\">VOTIVALIDI_C1</span>=<span class=\"syntax--string syntax--quoted syntax--double syntax--xml\"><span class=\"syntax--punctuation syntax--definition syntax--string syntax--begin syntax--xml\">&#8220;</span>37<span class=\"syntax--punctuation syntax--definition syntax--string syntax--end syntax--xml\">&#8220;</span></span> <span class=\"syntax--entity syntax--other syntax--attribute-name syntax--localname syntax--xml\">VCAS_C1</span>=<span class=\"syntax--string syntax--quoted syntax--double syntax--xml\"><span class=\"syntax--punctuation syntax--definition syntax--string syntax--begin syntax--xml\">&#8220;</span>0&#8243; VCNAS_C1=&#8221;0&#8243; VOTI_SOLO_C1=&#8221;0&#8243; VOTIVALIDI_C2=&#8221;0&#8243; VCAS_C2=&#8221;0&#8243; VCNAS_C2=&#8221;0&#8243; VCNAS_TOT=&#8221;0&#8243; VOTI_SOLO_C2=&#8221;0&#8243; VOTI_NULLI_SOLO_C2=&#8221;0&#8243; VOTI_NULLI=&#8221;0&#8243; NULLE=&#8221;21&#8243; BIANCHE=&#8221;8&#8243; CONFCONS=&#8221;S&#8221; MAXVOTVAL=&#8221;9&#8243;&gt;</span></span></span></div>\n<div class=\"line\"><span class=\"syntax--text syntax--xml\">        <span class=\"syntax--meta syntax--tag syntax--xml\"><span class=\"syntax--punctuation syntax--definition syntax--tag syntax--xml\">&lt;</span><span class=\"syntax--entity syntax--name syntax--tag syntax--localname syntax--xml\">V0</span> <span class=\"syntax--entity syntax--other syntax--attribute-name syntax--localname syntax--xml\">NUMERO</span>=<span class=\"syntax--string syntax--quoted syntax--double syntax--xml\"><span class=\"syntax--punctuation syntax--definition syntax--string syntax--begin syntax--xml\">&#8220;</span>12<span class=\"syntax--punctuation syntax--definition syntax--string syntax--end syntax--xml\">&#8220;</span></span> <span class=\"syntax--entity syntax--other syntax--attribute-name syntax--localname syntax--xml\">VOTIVALIDI_C0</span>=<span class=\"syntax--string syntax--quoted syntax--double syntax--xml\"><span class=\"syntax--punctuation syntax--definition syntax--string syntax--begin syntax--xml\">&#8220;</span>54<span class=\"syntax--punctuation syntax--definition syntax--string syntax--end syntax--xml\">&#8220;</span></span> <span class=\"syntax--entity syntax--other syntax--attribute-name syntax--localname syntax--xml\">TOT_VOTIVALIDI_C1</span>=<span class=\"syntax--string syntax--quoted syntax--double syntax--xml\"><span class=\"syntax--punctuation syntax--definition syntax--string syntax--begin syntax--xml\">&#8220;</span>37<span class=\"syntax--punctuation syntax--definition syntax--string syntax--end syntax--xml\">&#8220;</span></span> <span class=\"syntax--entity syntax--other syntax--attribute-name syntax--localname syntax--xml\">TOT_VOTISOLO_C1</span>=<span class=\"syntax--string syntax--quoted syntax--double syntax--xml\"><span class=\"syntax--punctuation syntax--definition syntax--string syntax--begin syntax--xml\">&#8220;</span>0<span class=\"syntax--punctuation syntax--definition syntax--string syntax--end syntax--xml\">&#8220;</span></span><span class=\"syntax--punctuation syntax--definition syntax--tag syntax--xml\">&gt;</span></span></span></div>\n<div class=\"line\"><span class=\"syntax--text syntax--xml\">            <span class=\"syntax--meta syntax--tag syntax--xml\"><span class=\"syntax--punctuation syntax--definition syntax--tag syntax--xml\">&lt;</span><span class=\"syntax--entity syntax--name syntax--tag syntax--localname syntax--xml\">V1</span> <span class=\"syntax--entity syntax--other syntax--attribute-name syntax--localname syntax--xml\">NUMERO</span>=<span class=\"syntax--string syntax--quoted syntax--double syntax--xml\"><span class=\"syntax--punctuation syntax--definition syntax--string syntax--begin syntax--xml\">&#8220;</span>1<span class=\"syntax--punctuation syntax--definition syntax--string syntax--end syntax--xml\">&#8220;</span></span> <span class=\"syntax--entity syntax--other syntax--attribute-name syntax--localname syntax--xml\">VOTIVALIDI_C1</span>=<span class=\"syntax--string syntax--quoted syntax--double syntax--xml\"><span class=\"syntax--punctuation syntax--definition syntax--string syntax--begin syntax--xml\">&#8220;</span>5<span class=\"syntax--punctuation syntax--definition syntax--string syntax--end syntax--xml\">&#8220;</span></span> <span class=\"syntax--entity syntax--other syntax--attribute-name syntax--localname syntax--xml\">VOTISOLO_C1</span>=<span class=\"syntax--string syntax--quoted syntax--double syntax--xml\"><span class=\"syntax--punctuation syntax--definition syntax--string syntax--begin syntax--xml\">&#8220;</span>0<span class=\"syntax--punctuation syntax--definition syntax--string syntax--end syntax--xml\">&#8220;</span></span> <span class=\"syntax--entity syntax--other syntax--attribute-name syntax--localname syntax--xml\">VOTCONASS_C1</span>=<span class=\"syntax--string syntax--quoted syntax--double syntax--xml\"><span class=\"syntax--punctuation syntax--definition syntax--string syntax--begin syntax--xml\">&#8220;</span>0<span class=\"syntax--punctuation syntax--definition syntax--string syntax--end syntax--xml\">&#8220;</span></span> <span class=\"syntax--entity syntax--other syntax--attribute-name syntax--localname syntax--xml\">VOTCONNONASS_C1</span>=<span class=\"syntax--string syntax--quoted syntax--double syntax--xml\"><span class=\"syntax--punctuation syntax--definition syntax--string syntax--begin syntax--xml\">&#8220;</span>0<span class=\"syntax--punctuation syntax--definition syntax--string syntax--end syntax--xml\">&#8220;</span></span> <span class=\"syntax--entity syntax--other syntax--attribute-name syntax--localname syntax--xml\">CIFRAIND</span>=<span class=\"syntax--string syntax--quoted syntax--double syntax--xml\"><span class=\"syntax--punctuation syntax--definition syntax--string syntax--begin syntax--xml\">&#8220;</span>59<span class=\"syntax--punctuation syntax--definition syntax--string syntax--end syntax--xml\">&#8220;</span></span> <span class=\"syntax--entity syntax--other syntax--attribute-name syntax--localname syntax--xml\">TOT_VOTIVALIDI_C2</span>=<span class=\"syntax--string syntax--quoted syntax--double syntax--xml\"><span class=\"syntax--punctuation syntax--definition syntax--string syntax--begin syntax--xml\">&#8220;</span>0<span class=\"syntax--punctuation syntax--definition syntax--string syntax--end syntax--xml\">&#8220;</span></span> <span class=\"syntax--entity syntax--other syntax--attribute-name syntax--localname syntax--xml\">TOT_VOTISOLO_C2</span>=<span class=\"syntax--string syntax--quoted syntax--double syntax--xml\"><span class=\"syntax--punctuation syntax--definition syntax--string syntax--begin syntax--xml\">&#8220;</span>0<span class=\"syntax--punctuation syntax--definition syntax--string syntax--end syntax--xml\">&#8220;</span></span><span class=\"syntax--punctuation syntax--definition syntax--tag syntax--xml\">/&gt;</span></span></span></div>\n<div class=\"line\"><span class=\"syntax--text syntax--xml\">            <span class=\"syntax--meta syntax--tag syntax--xml\"><span class=\"syntax--punctuation syntax--definition syntax--tag syntax--xml\">&lt;</span><span class=\"syntax--entity syntax--name syntax--tag syntax--localname syntax--xml\">V1</span> <span class=\"syntax--entity syntax--other syntax--attribute-name syntax--localname syntax--xml\">NUMERO</span>=<span class=\"syntax--string syntax--quoted syntax--double syntax--xml\"><span class=\"syntax--punctuation syntax--definition syntax--string syntax--begin syntax--xml\">&#8220;</span>2<span class=\"syntax--punctuation syntax--definition syntax--string syntax--end syntax--xml\">&#8220;</span></span> &#8230;<span class=\"syntax--punctuation syntax--definition syntax--tag syntax--xml\">/&gt;</span></span></span></div>\n<div class=\"line\"><span class=\"syntax--text syntax--xml\">            <span class=\"syntax--meta syntax--tag syntax--xml\"><span class=\"syntax--punctuation syntax--definition syntax--tag syntax--xml\">&lt;</span><span class=\"syntax--entity syntax--name syntax--tag syntax--localname syntax--xml\">V1</span> <span class=\"syntax--entity syntax--other syntax--attribute-name syntax--localname syntax--xml\">NUMERO</span>=<span class=\"syntax--string syntax--quoted syntax--double syntax--xml\"><span class=\"syntax--punctuation syntax--definition syntax--string syntax--begin syntax--xml\">&#8220;</span>3<span class=\"syntax--punctuation syntax--definition syntax--string syntax--end syntax--xml\">&#8220;</span></span> &#8230;<span class=\"syntax--punctuation syntax--definition syntax--tag syntax--xml\">/&gt;</span></span>        </span></div>\n<div class=\"line\"><span class=\"syntax--text syntax--xml\">        <span class=\"syntax--meta syntax--tag syntax--xml\"><span class=\"syntax--punctuation syntax--definition syntax--tag syntax--xml\">&lt;/</span><span class=\"syntax--entity syntax--name syntax--tag syntax--localname syntax--xml\">V0</span><span class=\"syntax--punctuation syntax--definition syntax--tag syntax--xml\">&gt;</span></span></span></div>\n<div class=\"line\"><span class=\"syntax--text syntax--xml\"><span class=\"syntax--meta syntax--tag syntax--xml\"><span class=\"syntax--punctuation syntax--definition syntax--tag syntax--xml\">&lt;/</span><span class=\"syntax--entity syntax--name syntax--tag syntax--localname syntax--xml\">SV</span><span class=\"syntax--punctuation syntax--definition syntax--tag syntax--xml\">&gt;</span></span></span></div>\n<p>&nbsp;</p>\n<p><code>SV</code> è la sezione elettorale con il suo numero identificativo (e altri attributi), che contiene al suo interno i dati su <code>V0</code> che rappresenta la lista (in questo caso la 12, quella del &#8220;Movimento 5 stelle&#8221;), che contiene al suo interno <code>V1</code>, ovvero i dati sui candidati al consiglio comunale. Con questa struttura gerarchica <code>SV&gt;V0&gt;V1</code>.</p>\n<p>Il comando di sopra nel dettaglio:</p>\n<ul>\n<li><code>sel --net -t -m</code>, abilito la selezione (<code>sel</code>) su un file remoto (<code>--net</code>), impostando un template (<code>-t</code>) per &#8220;mappare&#8221; gli elementi che corrispondono (&#8220;matchano&#8221; <code>-m</code>) alla seguente <em>query</em> XPATH;</li>\n<li><code>\"//SV/V0/V1\"</code>, i candidati al consiglio;</li>\n<li><code>\"@NUMERO\"</code>, l&#8217;attributo con il numero identificativo del candidato;</li>\n<li><code>-o \",\"</code>, per inserire un separatore di testo;</li>\n<li><code>-v \"@VOTIVALIDI_C1\"</code>, l&#8217;attributo con i voti validi del candidato;</li>\n<li><code>-o \",\"</code>, per inserire un separatore di testo;</li>\n<li><code>-v \"../@NUMERO\"</code>, mi muovo verso l&#8217;alto nella gerarchia dell&#8217;<code>XML</code> di un gradino con <code>..</code>, quindi vado in <code>V0</code> (la lista) e recupero l&#8217;identificativo numerico della lista;</li>\n<li><code>-o \",\"</code>, per inserire un separatore di testo;</li>\n<li><code>-v \"../../@NUMERO\"</code>, mi muovo verso l&#8217;alto nella gerarchia dell&#8217;<code>XML</code> di due gradini con <code>../..</code>, quindi vado in <code>SV</code> (il seggio) e recupero l&#8217;identificativo numerico del seggio;</li>\n<li><code>-n</code>, per inserire un&#8217;andata a capo per ogni risultato ottenuto;</li>\n<li><a href=\"http://.../SEZ_3_82053_L12.xml\">http://&#8230;/SEZ_3_82053_L12.xml</a> è l&#8217;URL del file XML.</li>\n</ul>\n<p>In output nella shell avrò:</p>\n<div class=\"line\"><span class=\"syntax--text syntax--plain\"><span class=\"syntax--meta syntax--paragraph syntax--text\">1,5,12,1</span></span></div>\n<div class=\"line\"><span class=\"syntax--text syntax--plain\"><span class=\"syntax--meta syntax--paragraph syntax--text\">2,9,12,1</span></span></div>\n<div class=\"line\"><span class=\"syntax--text syntax--plain\"><span class=\"syntax--meta syntax--paragraph syntax--text\">3,2,12,1</span></span></div>\n<div class=\"line\"><span class=\"syntax--text syntax--plain\"><span class=\"syntax--meta syntax--paragraph syntax--text\">&#8230;,&#8230;,&#8230;,&#8230;</span></span></div>\n<p>Ovvero</p>\n<table>\n<thead>\n<tr>\n<th>numeroCandidato</th>\n<th>voti</th>\n<th>numeroLista</th>\n<th>sezione</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>1</td>\n<td>5</td>\n<td>12</td>\n<td>1</td>\n</tr>\n<tr>\n<td>2</td>\n<td>9</td>\n<td>12</td>\n<td>1</td>\n</tr>\n<tr>\n<td>3</td>\n<td>2</td>\n<td>12</td>\n<td>1</td>\n</tr>\n<tr>\n<td>&#8230;</td>\n<td>&#8230;</td>\n<td>&#8230;</td>\n<td>&#8230;</td>\n</tr>\n</tbody>\n</table>\n<h1 id=\"creare-dei-file-csv-con-i-dati-per-tutte-le-liste\">Creare dei file CSV con i dati per tutte le liste</h1>\n<p>Ho pensato che possa essere molto interessante fare un esempio più ricco e completo e creare uno script <code>bash</code> per:</p>\n<ul>\n<li>scaricare tutti i file <code>XML</code> delle 18 liste;</li>\n<li>estrarre da ognuno l&#8217;anagrafica dei candidati consiglieri;</li>\n<li>estrarre da ognuno il numero di voti, per ogni sezione, di ogni candidato al consiglio;</li>\n<li>fare il <em>join</em> &#8211; unire &#8211; le info sul numero di voti, con l&#8217;anagrafica dei candidati consiglieri, e creare un file <code>CSV</code> per ogni lista;</li>\n<li>unire tutti i file <code>CSV</code> e produrre anche un unico file con il numero di voti di ogni candidato, per ogni lista, per ogni sezione.</li>\n</ul>\n<h2 id=\"requisiti\">Requisiti</h2>\n<p>Il prodotto finale è uno script <code>BASH</code>, quindi bisogna avere a disposizione un sistema compatibile con questo linguaggio (lo sono essenzialmente tutti).</p>\n<p>Richiede tre <em>utility</em>:</p>\n<ul>\n<li>l&#8217;immancabile cURL, per scaricare i file;</li>\n<li><a href=\"http://xmlstar.sourceforge.net/download.php\">XMLStarlet</a> per interrogare i file <code>XML</code> e trasformarli in file <code>CSV</code>;</li>\n<li><a href=\"http://csvkit.readthedocs.io/\">csvkit</a> per fare il <em>join</em> e il <em>merge</em> dei <code>CSV</code> scaricati.</li>\n</ul>\n<p>Richiede una <strong>conoscenza di base</strong> (e/o la volontà/possibità di farserla) su:</p>\n<ul>\n<li><a href=\"https://www.w3schools.com/xml/xpath_intro.asp\">XPATH</a>, per estrarre i dati (per interrogare) i file XML;</li>\n<li><a href=\"https://github.com/jlevy/the-art-of-command-line/blob/master/README-it.md\">la linea di comando</a>, perché è un po&#8217; il campo di gioco di queste modalità di accesso e modifica di file;</li>\n<li><a href=\"http://tldp.org/HOWTO/Bash-Prog-Intro-HOWTO.html#toc\">BASH</a>, che è il linguaggio dello script finale;</li>\n<li>aprire i file XML del comune con un buon editor di testo, guardarli un po’ e comprenderne la struttura.</li>\n</ul>\n<h2 id=\"lo-script\">Lo script</h2>\n<p>Lo script per intero è più in basso. A seguire un esploso delle varie parti che lo compongono.</p>\n<p>La prima cosa che viene eseguita nello script è il download dei file delle liste. Queste sono 18 ed è comodo scaricarle con un ciclo <code>for ... loop</code> che lo fa 18 volte per noi.</p>\n<div class=\"line\"><span class=\"syntax--source syntax--shell\"><span class=\"syntax--meta syntax--scope syntax--for-in-loop syntax--shell\"><span class=\"syntax--keyword syntax--control syntax--shell\">for</span> <span class=\"syntax--variable syntax--other syntax--loop syntax--shell\">i</span> <span class=\"syntax--keyword syntax--control syntax--shell\">in</span> {1..18}<span class=\"syntax--keyword syntax--operator syntax--list syntax--shell\">;</span></span></span></div>\n<div class=\"line\"><span class=\"syntax--source syntax--shell\"><span class=\"syntax--meta syntax--scope syntax--for-in-loop syntax--shell\">  <span class=\"syntax--keyword syntax--control syntax--shell\">do</span> curl -s <span class=\"syntax--string syntax--quoted syntax--double syntax--shell\"><span class=\"syntax--punctuation syntax--definition syntax--string syntax--begin syntax--shell\">&#8220;</span><span class=\"syntax--markup syntax--underline syntax--link syntax--http syntax--hyperlink\">http://comunali2017.comune.palermo.it/SEZ_3_82053_L</span><span class=\"syntax--variable syntax--other syntax--normal syntax--shell\"><span class=\"syntax--punctuation syntax--definition syntax--variable syntax--shell\">$</span>i</span>.xml<span class=\"syntax--punctuation syntax--definition syntax--string syntax--end syntax--shell\">&#8220;</span></span> <span class=\"syntax--keyword syntax--operator syntax--redirect syntax--shell\">&gt;</span> <span class=\"syntax--string syntax--quoted syntax--double syntax--shell\"><span class=\"syntax--punctuation syntax--definition syntax--string syntax--begin syntax--shell\">&#8220;</span><span class=\"syntax--variable syntax--other syntax--normal syntax--shell\"><span class=\"syntax--punctuation syntax--definition syntax--variable syntax--shell\">$</span>i</span><span class=\"syntax--punctuation syntax--definition syntax--string syntax--end syntax--shell\">&#8220;</span></span>.xml<span class=\"syntax--keyword syntax--operator syntax--list syntax--shell\">;</span></span></span></div>\n<div class=\"line\"><span class=\"syntax--source syntax--shell\"><span class=\"syntax--meta syntax--scope syntax--for-in-loop syntax--shell\"><span class=\"syntax--keyword syntax--control syntax--shell\">done</span></span></span></div>\n<p>&nbsp;</p>\n<p>Poi da ognuno dei 18 file <code>XML</code> vengono estratti i dati anagrafici e i dati per sezione, sempre con un ciclo <code>for</code>.<br />\nA ogni file viene aggiunta anche un&#8217;intestazione di colonne.</p>\n<div class=\"line\"><span class=\"syntax--source syntax--shell\"><span class=\"syntax--comment syntax--line syntax--number-sign syntax--shell\"><span class=\"syntax--punctuation syntax--definition syntax--comment syntax--shell\">#</span> scarico l&#8217;anagrafica di ogni candidato di ogni lista</span></span></div>\n<div class=\"line\"><span class=\"syntax--source syntax--shell\"><span class=\"syntax--meta syntax--scope syntax--for-in-loop syntax--shell\"><span class=\"syntax--keyword syntax--control syntax--shell\">for</span> <span class=\"syntax--variable syntax--other syntax--loop syntax--shell\">i</span> <span class=\"syntax--keyword syntax--control syntax--shell\">in</span> {1..18}<span class=\"syntax--keyword syntax--operator syntax--list syntax--shell\">;</span> <span class=\"syntax--keyword syntax--control syntax--shell\">do</span> xmlstarlet sel -t -m <span class=\"syntax--string syntax--quoted syntax--double syntax--shell\"><span class=\"syntax--punctuation syntax--definition syntax--string syntax--begin syntax--shell\">&#8220;</span>//C0/C1<span class=\"syntax--punctuation syntax--definition syntax--string syntax--end syntax--shell\">&#8220;</span></span> -v <span class=\"syntax--string syntax--quoted syntax--double syntax--shell\"><span class=\"syntax--punctuation syntax--definition syntax--string syntax--begin syntax--shell\">&#8220;</span>@NUMERO<span class=\"syntax--punctuation syntax--definition syntax--string syntax--end syntax--shell\">&#8220;</span></span> -o <span class=\"syntax--string syntax--quoted syntax--double syntax--shell\"><span class=\"syntax--punctuation syntax--definition syntax--string syntax--begin syntax--shell\">&#8220;</span>,<span class=\"syntax--punctuation syntax--definition syntax--string syntax--end syntax--shell\">&#8220;</span></span> -v <span class=\"syntax--string syntax--quoted syntax--double syntax--shell\"><span class=\"syntax--punctuation syntax--definition syntax--string syntax--begin syntax--shell\">&#8220;</span>@NOME<span class=\"syntax--punctuation syntax--definition syntax--string syntax--end syntax--shell\">&#8220;</span></span> -o <span class=\"syntax--string syntax--quoted syntax--double syntax--shell\"><span class=\"syntax--punctuation syntax--definition syntax--string syntax--begin syntax--shell\">&#8220;</span>,<span class=\"syntax--punctuation syntax--definition syntax--string syntax--end syntax--shell\">&#8220;</span></span> -v <span class=\"syntax--string syntax--quoted syntax--double syntax--shell\"><span class=\"syntax--punctuation syntax--definition syntax--string syntax--begin syntax--shell\">&#8220;</span>../@NUMERO<span class=\"syntax--punctuation syntax--definition syntax--string syntax--end syntax--shell\">&#8220;</span></span> -o <span class=\"syntax--string syntax--quoted syntax--double syntax--shell\"><span class=\"syntax--punctuation syntax--definition syntax--string syntax--begin syntax--shell\">&#8220;</span>,<span class=\"syntax--punctuation syntax--definition syntax--string syntax--end syntax--shell\">&#8220;</span></span> -v <span class=\"syntax--string syntax--quoted syntax--double syntax--shell\"><span class=\"syntax--punctuation syntax--definition syntax--string syntax--begin syntax--shell\">&#8220;</span>../@NOME<span class=\"syntax--punctuation syntax--definition syntax--string syntax--end syntax--shell\">&#8220;</span></span> -n <span class=\"syntax--string syntax--quoted syntax--double syntax--shell\"><span class=\"syntax--punctuation syntax--definition syntax--string syntax--begin syntax--shell\">&#8220;</span><span class=\"syntax--variable syntax--other syntax--normal syntax--shell\"><span class=\"syntax--punctuation syntax--definition syntax--variable syntax--shell\">$</span>i</span><span class=\"syntax--punctuation syntax--definition syntax--string syntax--end syntax--shell\">&#8220;</span></span>.xml <span class=\"syntax--keyword syntax--operator syntax--redirect syntax--shell\">&gt;</span> anagraficaLista_<span class=\"syntax--string syntax--quoted syntax--double syntax--shell\"><span class=\"syntax--punctuation syntax--definition syntax--string syntax--begin syntax--shell\">&#8220;</span><span class=\"syntax--variable syntax--other syntax--normal syntax--shell\"><span class=\"syntax--punctuation syntax--definition syntax--variable syntax--shell\">$</span>i</span><span class=\"syntax--punctuation syntax--definition syntax--string syntax--end syntax--shell\">&#8220;</span></span>.txt<span class=\"syntax--keyword syntax--operator syntax--list syntax--shell\">;</span> sed -i <span class=\"syntax--string syntax--quoted syntax--single syntax--shell\"><span class=\"syntax--punctuation syntax--definition syntax--string syntax--begin syntax--shell\">&#8216;</span>1s/^/numeroCandidato,nomeCandidato,numeroLista,nomeLista\\n/<span class=\"syntax--punctuation syntax--definition syntax--string syntax--end syntax--shell\">&#8216;</span></span> anagraficaLista_<span class=\"syntax--string syntax--quoted syntax--double syntax--shell\"><span class=\"syntax--punctuation syntax--definition syntax--string syntax--begin syntax--shell\">&#8220;</span><span class=\"syntax--variable syntax--other syntax--normal syntax--shell\"><span class=\"syntax--punctuation syntax--definition syntax--variable syntax--shell\">$</span>i</span><span class=\"syntax--punctuation syntax--definition syntax--string syntax--end syntax--shell\">&#8220;</span></span>.txt <span class=\"syntax--keyword syntax--operator syntax--list syntax--shell\">&amp;</span> <span class=\"syntax--keyword syntax--control syntax--shell\">done</span></span></span></div>\n<div class=\"line\"><span class=\"syntax--source syntax--shell\"> </span></div>\n<div class=\"line\"><span class=\"syntax--source syntax--shell\"><span class=\"syntax--comment syntax--line syntax--number-sign syntax--shell\"><span class=\"syntax--punctuation syntax--definition syntax--comment syntax--shell\">#</span> scarico i voti di ogni candidato di ogni lista per ogni sezione</span></span></div>\n<div class=\"line\"><span class=\"syntax--source syntax--shell\"><span class=\"syntax--meta syntax--scope syntax--for-in-loop syntax--shell\"><span class=\"syntax--keyword syntax--control syntax--shell\">for</span> <span class=\"syntax--variable syntax--other syntax--loop syntax--shell\">i</span> <span class=\"syntax--keyword syntax--control syntax--shell\">in</span> {1..18}<span class=\"syntax--keyword syntax--operator syntax--list syntax--shell\">;</span> <span class=\"syntax--keyword syntax--control syntax--shell\">do</span> xmlstarlet sel -t -m <span class=\"syntax--string syntax--quoted syntax--double syntax--shell\"><span class=\"syntax--punctuation syntax--definition syntax--string syntax--begin syntax--shell\">&#8220;</span>//SV/V0/V1<span class=\"syntax--punctuation syntax--definition syntax--string syntax--end syntax--shell\">&#8220;</span></span> -v <span class=\"syntax--string syntax--quoted syntax--double syntax--shell\"><span class=\"syntax--punctuation syntax--definition syntax--string syntax--begin syntax--shell\">&#8220;</span>@NUMERO<span class=\"syntax--punctuation syntax--definition syntax--string syntax--end syntax--shell\">&#8220;</span></span> -o <span class=\"syntax--string syntax--quoted syntax--double syntax--shell\"><span class=\"syntax--punctuation syntax--definition syntax--string syntax--begin syntax--shell\">&#8220;</span>,<span class=\"syntax--punctuation syntax--definition syntax--string syntax--end syntax--shell\">&#8220;</span></span> -v <span class=\"syntax--string syntax--quoted syntax--double syntax--shell\"><span class=\"syntax--punctuation syntax--definition syntax--string syntax--begin syntax--shell\">&#8220;</span>@VOTIVALIDI_C1<span class=\"syntax--punctuation syntax--definition syntax--string syntax--end syntax--shell\">&#8220;</span></span> -o <span class=\"syntax--string syntax--quoted syntax--double syntax--shell\"><span class=\"syntax--punctuation syntax--definition syntax--string syntax--begin syntax--shell\">&#8220;</span>,<span class=\"syntax--punctuation syntax--definition syntax--string syntax--end syntax--shell\">&#8220;</span></span>  -v <span class=\"syntax--string syntax--quoted syntax--double syntax--shell\"><span class=\"syntax--punctuation syntax--definition syntax--string syntax--begin syntax--shell\">&#8220;</span>../@NUMERO<span class=\"syntax--punctuation syntax--definition syntax--string syntax--end syntax--shell\">&#8220;</span></span> -o <span class=\"syntax--string syntax--quoted syntax--double syntax--shell\"><span class=\"syntax--punctuation syntax--definition syntax--string syntax--begin syntax--shell\">&#8220;</span>,<span class=\"syntax--punctuation syntax--definition syntax--string syntax--end syntax--shell\">&#8220;</span></span> -v <span class=\"syntax--string syntax--quoted syntax--double syntax--shell\"><span class=\"syntax--punctuation syntax--definition syntax--string syntax--begin syntax--shell\">&#8220;</span>../../@NUMERO<span class=\"syntax--punctuation syntax--definition syntax--string syntax--end syntax--shell\">&#8220;</span></span> -n <span class=\"syntax--string syntax--quoted syntax--double syntax--shell\"><span class=\"syntax--punctuation syntax--definition syntax--string syntax--begin syntax--shell\">&#8220;</span><span class=\"syntax--variable syntax--other syntax--normal syntax--shell\"><span class=\"syntax--punctuation syntax--definition syntax--variable syntax--shell\">$</span>i</span><span class=\"syntax--punctuation syntax--definition syntax--string syntax--end syntax--shell\">&#8220;</span></span>.xml <span class=\"syntax--keyword syntax--operator syntax--redirect syntax--shell\">&gt;</span> listaSezioni_<span class=\"syntax--string syntax--quoted syntax--double syntax--shell\"><span class=\"syntax--punctuation syntax--definition syntax--string syntax--begin syntax--shell\">&#8220;</span><span class=\"syntax--variable syntax--other syntax--normal syntax--shell\"><span class=\"syntax--punctuation syntax--definition syntax--variable syntax--shell\">$</span>i</span><span class=\"syntax--punctuation syntax--definition syntax--string syntax--end syntax--shell\">&#8220;</span></span>.txt <span class=\"syntax--keyword syntax--operator syntax--list syntax--shell\">;</span> sed  -i <span class=\"syntax--string syntax--quoted syntax--single syntax--shell\"><span class=\"syntax--punctuation syntax--definition syntax--string syntax--begin syntax--shell\">&#8216;</span>1s/^/numeroCandidato,voti,numeroLista,sezione\\n/<span class=\"syntax--punctuation syntax--definition syntax--string syntax--end syntax--shell\">&#8216;</span></span> listaSezioni_<span class=\"syntax--string syntax--quoted syntax--double syntax--shell\"><span class=\"syntax--punctuation syntax--definition syntax--string syntax--begin syntax--shell\">&#8220;</span><span class=\"syntax--variable syntax--other syntax--normal syntax--shell\"><span class=\"syntax--punctuation syntax--definition syntax--variable syntax--shell\">$</span>i</span><span class=\"syntax--punctuation syntax--definition syntax--string syntax--end syntax--shell\">&#8220;</span></span>.txt <span class=\"syntax--keyword syntax--operator syntax--list syntax--shell\">&amp;</span> <span class=\"syntax--keyword syntax--control syntax--shell\">done</span></span></span></div>\n<p>&nbsp;</p>\n<p>I file di anagrafica hanno questa struttura:</p>\n<table>\n<thead>\n<tr>\n<th>numeroCandidato</th>\n<th>nomeCandidato</th>\n<th>numeroLista</th>\n<th>nomeLista</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>1</td>\n<td>GELARDA IGOR DETTO GERARDA DETTO GERALDA</td>\n<td>12</td>\n<td>MOVIMENTO 5 STELLE</td>\n</tr>\n<tr>\n<td>2</td>\n<td>ARGIROFFI GIULIA</td>\n<td>12</td>\n<td>MOVIMENTO 5 STELLE</td>\n</tr>\n<tr>\n<td>3</td>\n<td>CAPARROTTA GIANCARLO DETTO CAPAROTTA</td>\n<td>12</td>\n<td>MOVIMENTO 5 STELLE</td>\n</tr>\n</tbody>\n</table>\n<p>Mentre quelli con i dati per sezione:</p>\n<table>\n<thead>\n<tr>\n<th>numeroCandidato</th>\n<th>voti</th>\n<th>numeroLista</th>\n<th>sezione</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>1</td>\n<td>5</td>\n<td>12</td>\n<td>1</td>\n</tr>\n<tr>\n<td>2</td>\n<td>9</td>\n<td>12</td>\n<td>1</td>\n</tr>\n<tr>\n<td>3</td>\n<td>2</td>\n<td>12</td>\n<td>1</td>\n</tr>\n</tbody>\n</table>\n<p>Poi viene fatto il <em>join</em> tra anagrafica e dati per sezione:</p>\n<div class=\"line\"><span class=\"syntax--source syntax--shell\"><span class=\"syntax--meta syntax--scope syntax--for-in-loop syntax--shell\"><span class=\"syntax--keyword syntax--control syntax--shell\">for</span> <span class=\"syntax--variable syntax--other syntax--loop syntax--shell\">i</span> <span class=\"syntax--keyword syntax--control syntax--shell\">in</span> {1..18}<span class=\"syntax--keyword syntax--operator syntax--list syntax--shell\">;</span> <span class=\"syntax--keyword syntax--control syntax--shell\">do</span> csvsql &#8211;query <span class=\"syntax--string syntax--quoted syntax--double syntax--shell\"><span class=\"syntax--punctuation syntax--definition syntax--string syntax--begin syntax--shell\">&#8220;</span>select * from  listaSezioni_<span class=\"syntax--variable syntax--other syntax--normal syntax--shell\"><span class=\"syntax--punctuation syntax--definition syntax--variable syntax--shell\">$</span>i</span> LEFT JOIN anagraficaLista_<span class=\"syntax--variable syntax--other syntax--normal syntax--shell\"><span class=\"syntax--punctuation syntax--definition syntax--variable syntax--shell\">$</span>i</span> ON listaSezioni_<span class=\"syntax--variable syntax--other syntax--normal syntax--shell\"><span class=\"syntax--punctuation syntax--definition syntax--variable syntax--shell\">$</span>i</span>.numeroCandidato=anagraficaLista_<span class=\"syntax--variable syntax--other syntax--normal syntax--shell\"><span class=\"syntax--punctuation syntax--definition syntax--variable syntax--shell\">$</span>i</span>.numeroCandidato<span class=\"syntax--punctuation syntax--definition syntax--string syntax--end syntax--shell\">&#8220;</span></span> listaSezioni_<span class=\"syntax--string syntax--quoted syntax--double syntax--shell\"><span class=\"syntax--punctuation syntax--definition syntax--string syntax--begin syntax--shell\">&#8220;</span><span class=\"syntax--variable syntax--other syntax--normal syntax--shell\"><span class=\"syntax--punctuation syntax--definition syntax--variable syntax--shell\">$</span>i</span><span class=\"syntax--punctuation syntax--definition syntax--string syntax--end syntax--shell\">&#8220;</span></span>.txt anagraficaLista_<span class=\"syntax--string syntax--quoted syntax--double syntax--shell\"><span class=\"syntax--punctuation syntax--definition syntax--string syntax--begin syntax--shell\">&#8220;</span><span class=\"syntax--variable syntax--other syntax--normal syntax--shell\"><span class=\"syntax--punctuation syntax--definition syntax--variable syntax--shell\">$</span>i</span><span class=\"syntax--punctuation syntax--definition syntax--string syntax--end syntax--shell\">&#8220;</span></span>.txt <span class=\"syntax--keyword syntax--operator syntax--redirect syntax--shell\">&gt;</span> lista_<span class=\"syntax--string syntax--quoted syntax--double syntax--shell\"><span class=\"syntax--punctuation syntax--definition syntax--string syntax--begin syntax--shell\">&#8220;</span><span class=\"syntax--variable syntax--other syntax--normal syntax--shell\"><span class=\"syntax--punctuation syntax--definition syntax--variable syntax--shell\">$</span>i</span><span class=\"syntax--punctuation syntax--definition syntax--string syntax--end syntax--shell\">&#8220;</span></span>.csv<span class=\"syntax--keyword syntax--operator syntax--list syntax--shell\">;</span> <span class=\"syntax--keyword syntax--control syntax--shell\">done</span></span></span></div>\n<div></div>\n<p>Per ogni lista viene prodotto un file con nome <code>lista_NumeroLista.csv</code>, con questa struttura (ci sono delle colonne duplicate, che potrei rimuovere in fase di <em>join</em>):</p>\n<table>\n<thead>\n<tr>\n<th>numeroCandidato</th>\n<th>voti</th>\n<th>numeroLista</th>\n<th>sezione</th>\n<th>numeroCandidato</th>\n<th>nomeCandidato</th>\n<th>numeroLista</th>\n<th>nomeLista</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>1</td>\n<td>5</td>\n<td>12</td>\n<td>1</td>\n<td>1</td>\n<td>GELARDA IGOR DETTO GERARDA DETTO GERALDA</td>\n<td>12</td>\n<td>MOVIMENTO 5 STELLE</td>\n</tr>\n<tr>\n<td>2</td>\n<td>9</td>\n<td>12</td>\n<td>1</td>\n<td>2</td>\n<td>ARGIROFFI GIULIA</td>\n<td>12</td>\n<td>MOVIMENTO 5 STELLE</td>\n</tr>\n<tr>\n<td>3</td>\n<td>2</td>\n<td>12</td>\n<td>1</td>\n<td>3</td>\n<td>CAPARROTTA GIANCARLO DETTO CAPAROTTA</td>\n<td>12</td>\n<td>MOVIMENTO 5 STELLE</td>\n</tr>\n</tbody>\n</table>\n<p>E infine viene creato anche un unico file <code>CSV</code> di insieme (scaricabile da <a href=\"https://query.data.world/s/ayn93vioydu7l9heo64wg228w\">qui</a>), con i dati per tutti i consiglieri di tutte le liste, per ogni sezione (senza le colonne duplicate). Sono 638 candidati per 600 sezioni per un totale di 382800 record.</p>\n<div class=\"line\"><span class=\"syntax--source syntax--shell\">csvstack <span class=\"syntax--keyword syntax--operator syntax--glob syntax--shell\">*</span>.csv <span class=\"syntax--keyword syntax--operator syntax--pipe syntax--shell\">|</span> csvcut -c 1,2,3,4,6,8 <span class=\"syntax--keyword syntax--operator syntax--redirect syntax--shell\">&gt;</span> liste.csv</span></div>\n<div></div>\n<p>Quindi avrò in output 1 file <code>CSV</code> con i dati per ogni lista e quello soprastante, per totale di 19 file <code>CSV</code> (encoding <code>UTF-8</code> e come separatore la <code>,</code>).</p>\n<p>Lo script di poche righe (al netto dei commenti) è quello di sotto, tutto realizzato con oggetti <em>free </em>e<em> open-source</em>.</p>\n<div class=\"line\"><span class=\"syntax--source syntax--shell\"><span class=\"syntax--comment syntax--line syntax--number-sign syntax--shebang syntax--shell\"><span class=\"syntax--punctuation syntax--definition syntax--comment syntax--shebang syntax--shell\">#!</span>/bin/bash</span></span></div>\n<div class=\"line\"><span class=\"syntax--source syntax--shell\"> </span></div>\n<div class=\"line\"><span class=\"syntax--source syntax--shell\"><span class=\"syntax--comment syntax--line syntax--number-sign syntax--shell\"><span class=\"syntax--punctuation syntax--definition syntax--comment syntax--shell\">#</span> Requisiti #</span></span></div>\n<div class=\"line\"><span class=\"syntax--source syntax--shell\"><span class=\"syntax--comment syntax--line syntax--number-sign syntax--shell\"><span class=\"syntax--punctuation syntax--definition syntax--comment syntax--shell\">#</span> &#8211; avere un sistema in cui è possibile eseguire uno script bash;</span></span></div>\n<div class=\"line\"><span class=\"syntax--source syntax--shell\"><span class=\"syntax--comment syntax--line syntax--number-sign syntax--shell\"><span class=\"syntax--punctuation syntax--definition syntax--comment syntax--shell\">#</span> &#8211; l&#8217;utility XMLStarlet <span class=\"syntax--markup syntax--underline syntax--link syntax--http syntax--hyperlink\">http://xmlstar.sourceforge.net/download.php</span></span></span></div>\n<div class=\"line\"><span class=\"syntax--source syntax--shell\"><span class=\"syntax--comment syntax--line syntax--number-sign syntax--shell\"><span class=\"syntax--punctuation syntax--definition syntax--comment syntax--shell\">#</span> &#8211; l&#8217;utility csvkit <span class=\"syntax--markup syntax--underline syntax--link syntax--http syntax--hyperlink\">http://csvkit.readthedocs.io/</span></span></span></div>\n<div class=\"line\"><span class=\"syntax--source syntax--shell\"> </span></div>\n<div class=\"line\"><span class=\"syntax--source syntax--shell\"><span class=\"syntax--comment syntax--line syntax--number-sign syntax--shell\"><span class=\"syntax--punctuation syntax--definition syntax--comment syntax--shell\">#</span> attivo la modalità di debug</span></span></div>\n<div class=\"line\"><span class=\"syntax--source syntax--shell\"><span class=\"syntax--support syntax--function syntax--builtin syntax--shell\">set</span> -x</span></div>\n<div class=\"line\"><span class=\"syntax--source syntax--shell\"> </span></div>\n<div class=\"line\"><span class=\"syntax--source syntax--shell\"><span class=\"syntax--comment syntax--line syntax--number-sign syntax--shell\"><span class=\"syntax--punctuation syntax--definition syntax--comment syntax--shell\">#</span> cancello file csv e xml pre esistenti nella cartella in cui lancio lo script</span></span></div>\n<div class=\"line\"><span class=\"syntax--source syntax--shell\">rm -R <span class=\"syntax--keyword syntax--operator syntax--glob syntax--shell\">*</span>.csv</span></div>\n<div class=\"line\"><span class=\"syntax--source syntax--shell\"> </span></div>\n<div class=\"line\"><span class=\"syntax--source syntax--shell\"><span class=\"syntax--comment syntax--line syntax--number-sign syntax--shell\"><span class=\"syntax--punctuation syntax--definition syntax--comment syntax--shell\">#</span> scarico tutti i dati delle 18 liste</span></span></div>\n<div class=\"line\"><span class=\"syntax--source syntax--shell\"><span class=\"syntax--meta syntax--scope syntax--for-in-loop syntax--shell\"><span class=\"syntax--keyword syntax--control syntax--shell\">for</span> <span class=\"syntax--variable syntax--other syntax--loop syntax--shell\">i</span> <span class=\"syntax--keyword syntax--control syntax--shell\">in</span> {1..18}<span class=\"syntax--keyword syntax--operator syntax--list syntax--shell\">;</span> <span class=\"syntax--keyword syntax--control syntax--shell\">do</span> curl -s <span class=\"syntax--string syntax--quoted syntax--double syntax--shell\"><span class=\"syntax--punctuation syntax--definition syntax--string syntax--begin syntax--shell\">&#8220;</span><span class=\"syntax--markup syntax--underline syntax--link syntax--http syntax--hyperlink\">http://comunali2017.comune.palermo.it/SEZ_3_82053_L</span><span class=\"syntax--variable syntax--other syntax--normal syntax--shell\"><span class=\"syntax--punctuation syntax--definition syntax--variable syntax--shell\">$</span>i</span>.xml<span class=\"syntax--punctuation syntax--definition syntax--string syntax--end syntax--shell\">&#8220;</span></span> <span class=\"syntax--keyword syntax--operator syntax--redirect syntax--shell\">&gt;</span> <span class=\"syntax--string syntax--quoted syntax--double syntax--shell\"><span class=\"syntax--punctuation syntax--definition syntax--string syntax--begin syntax--shell\">&#8220;</span><span class=\"syntax--variable syntax--other syntax--normal syntax--shell\"><span class=\"syntax--punctuation syntax--definition syntax--variable syntax--shell\">$</span>i</span><span class=\"syntax--punctuation syntax--definition syntax--string syntax--end syntax--shell\">&#8220;</span></span>.xml<span class=\"syntax--keyword syntax--operator syntax--list syntax--shell\">;</span><span class=\"syntax--keyword syntax--control syntax--shell\">done</span></span></span></div>\n<div class=\"line\"><span class=\"syntax--source syntax--shell\"> </span></div>\n<div class=\"line\"><span class=\"syntax--source syntax--shell\"><span class=\"syntax--comment syntax--line syntax--number-sign syntax--shell\"><span class=\"syntax--punctuation syntax--definition syntax--comment syntax--shell\">#</span> scarico l&#8217;anagrafica di ogni candidato di ogni lista</span></span></div>\n<div class=\"line\"><span class=\"syntax--source syntax--shell\"><span class=\"syntax--meta syntax--scope syntax--for-in-loop syntax--shell\"><span class=\"syntax--keyword syntax--control syntax--shell\">for</span> <span class=\"syntax--variable syntax--other syntax--loop syntax--shell\">i</span> <span class=\"syntax--keyword syntax--control syntax--shell\">in</span> {1..18}<span class=\"syntax--keyword syntax--operator syntax--list syntax--shell\">;</span> <span class=\"syntax--keyword syntax--control syntax--shell\">do</span> xmlstarlet sel -t -m <span class=\"syntax--string syntax--quoted syntax--double syntax--shell\"><span class=\"syntax--punctuation syntax--definition syntax--string syntax--begin syntax--shell\">&#8220;</span>//C0/C1<span class=\"syntax--punctuation syntax--definition syntax--string syntax--end syntax--shell\">&#8220;</span></span> -v <span class=\"syntax--string syntax--quoted syntax--double syntax--shell\"><span class=\"syntax--punctuation syntax--definition syntax--string syntax--begin syntax--shell\">&#8220;</span>@NUMERO<span class=\"syntax--punctuation syntax--definition syntax--string syntax--end syntax--shell\">&#8220;</span></span> -o <span class=\"syntax--string syntax--quoted syntax--double syntax--shell\"><span class=\"syntax--punctuation syntax--definition syntax--string syntax--begin syntax--shell\">&#8220;</span>,<span class=\"syntax--punctuation syntax--definition syntax--string syntax--end syntax--shell\">&#8220;</span></span> -v <span class=\"syntax--string syntax--quoted syntax--double syntax--shell\"><span class=\"syntax--punctuation syntax--definition syntax--string syntax--begin syntax--shell\">&#8220;</span>@NOME<span class=\"syntax--punctuation syntax--definition syntax--string syntax--end syntax--shell\">&#8220;</span></span> -o <span class=\"syntax--string syntax--quoted syntax--double syntax--shell\"><span class=\"syntax--punctuation syntax--definition syntax--string syntax--begin syntax--shell\">&#8220;</span>,<span class=\"syntax--punctuation syntax--definition syntax--string syntax--end syntax--shell\">&#8220;</span></span> -v <span class=\"syntax--string syntax--quoted syntax--double syntax--shell\"><span class=\"syntax--punctuation syntax--definition syntax--string syntax--begin syntax--shell\">&#8220;</span>../@NUMERO<span class=\"syntax--punctuation syntax--definition syntax--string syntax--end syntax--shell\">&#8220;</span></span> -o <span class=\"syntax--string syntax--quoted syntax--double syntax--shell\"><span class=\"syntax--punctuation syntax--definition syntax--string syntax--begin syntax--shell\">&#8220;</span>,<span class=\"syntax--punctuation syntax--definition syntax--string syntax--end syntax--shell\">&#8220;</span></span> -v <span class=\"syntax--string syntax--quoted syntax--double syntax--shell\"><span class=\"syntax--punctuation syntax--definition syntax--string syntax--begin syntax--shell\">&#8220;</span>../@NOME<span class=\"syntax--punctuation syntax--definition syntax--string syntax--end syntax--shell\">&#8220;</span></span> -n <span class=\"syntax--string syntax--quoted syntax--double syntax--shell\"><span class=\"syntax--punctuation syntax--definition syntax--string syntax--begin syntax--shell\">&#8220;</span><span class=\"syntax--variable syntax--other syntax--normal syntax--shell\"><span class=\"syntax--punctuation syntax--definition syntax--variable syntax--shell\">$</span>i</span><span class=\"syntax--punctuation syntax--definition syntax--string syntax--end syntax--shell\">&#8220;</span></span>.xml <span class=\"syntax--keyword syntax--operator syntax--redirect syntax--shell\">&gt;</span> anagraficaLista_<span class=\"syntax--string syntax--quoted syntax--double syntax--shell\"><span class=\"syntax--punctuation syntax--definition syntax--string syntax--begin syntax--shell\">&#8220;</span><span class=\"syntax--variable syntax--other syntax--normal syntax--shell\"><span class=\"syntax--punctuation syntax--definition syntax--variable syntax--shell\">$</span>i</span><span class=\"syntax--punctuation syntax--definition syntax--string syntax--end syntax--shell\">&#8220;</span></span>.txt<span class=\"syntax--keyword syntax--operator syntax--list syntax--shell\">;</span> sed -i <span class=\"syntax--string syntax--quoted syntax--single syntax--shell\"><span class=\"syntax--punctuation syntax--definition syntax--string syntax--begin syntax--shell\">&#8216;</span>1s/^/numeroCandidato,nomeCandidato,numeroLista,nomeLista\\n/<span class=\"syntax--punctuation syntax--definition syntax--string syntax--end syntax--shell\">&#8216;</span></span> anagraficaLista_<span class=\"syntax--string syntax--quoted syntax--double syntax--shell\"><span class=\"syntax--punctuation syntax--definition syntax--string syntax--begin syntax--shell\">&#8220;</span><span class=\"syntax--variable syntax--other syntax--normal syntax--shell\"><span class=\"syntax--punctuation syntax--definition syntax--variable syntax--shell\">$</span>i</span><span class=\"syntax--punctuation syntax--definition syntax--string syntax--end syntax--shell\">&#8220;</span></span>.txt <span class=\"syntax--keyword syntax--operator syntax--list syntax--shell\">&amp;</span> <span class=\"syntax--keyword syntax--control syntax--shell\">done</span></span></span></div>\n<div class=\"line\"><span class=\"syntax--source syntax--shell\"> </span></div>\n<div class=\"line\"><span class=\"syntax--source syntax--shell\"><span class=\"syntax--comment syntax--line syntax--number-sign syntax--shell\"><span class=\"syntax--punctuation syntax--definition syntax--comment syntax--shell\">#</span> scarico i voti di ogni candidato di ogni lista per ogni sezione</span></span></div>\n<div class=\"line\"><span class=\"syntax--source syntax--shell\"><span class=\"syntax--meta syntax--scope syntax--for-in-loop syntax--shell\"><span class=\"syntax--keyword syntax--control syntax--shell\">for</span> <span class=\"syntax--variable syntax--other syntax--loop syntax--shell\">i</span> <span class=\"syntax--keyword syntax--control syntax--shell\">in</span> {1..18}<span class=\"syntax--keyword syntax--operator syntax--list syntax--shell\">;</span> <span class=\"syntax--keyword syntax--control syntax--shell\">do</span> xmlstarlet sel -t -m <span class=\"syntax--string syntax--quoted syntax--double syntax--shell\"><span class=\"syntax--punctuation syntax--definition syntax--string syntax--begin syntax--shell\">&#8220;</span>//SV/V0/V1<span class=\"syntax--punctuation syntax--definition syntax--string syntax--end syntax--shell\">&#8220;</span></span> -v <span class=\"syntax--string syntax--quoted syntax--double syntax--shell\"><span class=\"syntax--punctuation syntax--definition syntax--string syntax--begin syntax--shell\">&#8220;</span>@NUMERO<span class=\"syntax--punctuation syntax--definition syntax--string syntax--end syntax--shell\">&#8220;</span></span> -o <span class=\"syntax--string syntax--quoted syntax--double syntax--shell\"><span class=\"syntax--punctuation syntax--definition syntax--string syntax--begin syntax--shell\">&#8220;</span>,<span class=\"syntax--punctuation syntax--definition syntax--string syntax--end syntax--shell\">&#8220;</span></span> -v <span class=\"syntax--string syntax--quoted syntax--double syntax--shell\"><span class=\"syntax--punctuation syntax--definition syntax--string syntax--begin syntax--shell\">&#8220;</span>@VOTIVALIDI_C1<span class=\"syntax--punctuation syntax--definition syntax--string syntax--end syntax--shell\">&#8220;</span></span> -o <span class=\"syntax--string syntax--quoted syntax--double syntax--shell\"><span class=\"syntax--punctuation syntax--definition syntax--string syntax--begin syntax--shell\">&#8220;</span>,<span class=\"syntax--punctuation syntax--definition syntax--string syntax--end syntax--shell\">&#8220;</span></span>  -v <span class=\"syntax--string syntax--quoted syntax--double syntax--shell\"><span class=\"syntax--punctuation syntax--definition syntax--string syntax--begin syntax--shell\">&#8220;</span>../@NUMERO<span class=\"syntax--punctuation syntax--definition syntax--string syntax--end syntax--shell\">&#8220;</span></span> -o <span class=\"syntax--string syntax--quoted syntax--double syntax--shell\"><span class=\"syntax--punctuation syntax--definition syntax--string syntax--begin syntax--shell\">&#8220;</span>,<span class=\"syntax--punctuation syntax--definition syntax--string syntax--end syntax--shell\">&#8220;</span></span> -v <span class=\"syntax--string syntax--quoted syntax--double syntax--shell\"><span class=\"syntax--punctuation syntax--definition syntax--string syntax--begin syntax--shell\">&#8220;</span>../../@NUMERO<span class=\"syntax--punctuation syntax--definition syntax--string syntax--end syntax--shell\">&#8220;</span></span> -n <span class=\"syntax--string syntax--quoted syntax--double syntax--shell\"><span class=\"syntax--punctuation syntax--definition syntax--string syntax--begin syntax--shell\">&#8220;</span><span class=\"syntax--variable syntax--other syntax--normal syntax--shell\"><span class=\"syntax--punctuation syntax--definition syntax--variable syntax--shell\">$</span>i</span><span class=\"syntax--punctuation syntax--definition syntax--string syntax--end syntax--shell\">&#8220;</span></span>.xml <span class=\"syntax--keyword syntax--operator syntax--redirect syntax--shell\">&gt;</span> listaSezioni_<span class=\"syntax--string syntax--quoted syntax--double syntax--shell\"><span class=\"syntax--punctuation syntax--definition syntax--string syntax--begin syntax--shell\">&#8220;</span><span class=\"syntax--variable syntax--other syntax--normal syntax--shell\"><span class=\"syntax--punctuation syntax--definition syntax--variable syntax--shell\">$</span>i</span><span class=\"syntax--punctuation syntax--definition syntax--string syntax--end syntax--shell\">&#8220;</span></span>.txt <span class=\"syntax--keyword syntax--operator syntax--list syntax--shell\">;</span> sed  -i <span class=\"syntax--string syntax--quoted syntax--single syntax--shell\"><span class=\"syntax--punctuation syntax--definition syntax--string syntax--begin syntax--shell\">&#8216;</span>1s/^/numeroCandidato,voti,numeroLista,sezione\\n/<span class=\"syntax--punctuation syntax--definition syntax--string syntax--end syntax--shell\">&#8216;</span></span> listaSezioni_<span class=\"syntax--string syntax--quoted syntax--double syntax--shell\"><span class=\"syntax--punctuation syntax--definition syntax--string syntax--begin syntax--shell\">&#8220;</span><span class=\"syntax--variable syntax--other syntax--normal syntax--shell\"><span class=\"syntax--punctuation syntax--definition syntax--variable syntax--shell\">$</span>i</span><span class=\"syntax--punctuation syntax--definition syntax--string syntax--end syntax--shell\">&#8220;</span></span>.txt <span class=\"syntax--keyword syntax--operator syntax--list syntax--shell\">&amp;</span> <span class=\"syntax--keyword syntax--control syntax--shell\">done</span></span></span></div>\n<div class=\"line\"><span class=\"syntax--source syntax--shell\"> </span></div>\n<div class=\"line\"><span class=\"syntax--source syntax--shell\"><span class=\"syntax--comment syntax--line syntax--number-sign syntax--shell\"><span class=\"syntax--punctuation syntax--definition syntax--comment syntax--shell\">#</span> faccio il join tra i dati per sezione e l&#8217;anagrafica dei candidati</span></span></div>\n<div class=\"line\"><span class=\"syntax--source syntax--shell\"><span class=\"syntax--comment syntax--line syntax--number-sign syntax--shell\"><span class=\"syntax--punctuation syntax--definition syntax--comment syntax--shell\">#</span> l&#8217;output è un file di dettaglio in formato CSV per ogni lista</span></span></div>\n<div class=\"line\"><span class=\"syntax--source syntax--shell\"><span class=\"syntax--meta syntax--scope syntax--for-in-loop syntax--shell\"><span class=\"syntax--keyword syntax--control syntax--shell\">for</span> <span class=\"syntax--variable syntax--other syntax--loop syntax--shell\">i</span> <span class=\"syntax--keyword syntax--control syntax--shell\">in</span> {1..18}<span class=\"syntax--keyword syntax--operator syntax--list syntax--shell\">;</span> <span class=\"syntax--keyword syntax--control syntax--shell\">do</span> csvsql &#8211;query <span class=\"syntax--string syntax--quoted syntax--double syntax--shell\"><span class=\"syntax--punctuation syntax--definition syntax--string syntax--begin syntax--shell\">&#8220;</span>select * from  listaSezioni_<span class=\"syntax--variable syntax--other syntax--normal syntax--shell\"><span class=\"syntax--punctuation syntax--definition syntax--variable syntax--shell\">$</span>i</span> LEFT JOIN anagraficaLista_<span class=\"syntax--variable syntax--other syntax--normal syntax--shell\"><span class=\"syntax--punctuation syntax--definition syntax--variable syntax--shell\">$</span>i</span> ON listaSezioni_<span class=\"syntax--variable syntax--other syntax--normal syntax--shell\"><span class=\"syntax--punctuation syntax--definition syntax--variable syntax--shell\">$</span>i</span>.numeroCandidato=anagraficaLista_<span class=\"syntax--variable syntax--other syntax--normal syntax--shell\"><span class=\"syntax--punctuation syntax--definition syntax--variable syntax--shell\">$</span>i</span>.numeroCandidato<span class=\"syntax--punctuation syntax--definition syntax--string syntax--end syntax--shell\">&#8220;</span></span> listaSezioni_<span class=\"syntax--string syntax--quoted syntax--double syntax--shell\"><span class=\"syntax--punctuation syntax--definition syntax--string syntax--begin syntax--shell\">&#8220;</span><span class=\"syntax--variable syntax--other syntax--normal syntax--shell\"><span class=\"syntax--punctuation syntax--definition syntax--variable syntax--shell\">$</span>i</span><span class=\"syntax--punctuation syntax--definition syntax--string syntax--end syntax--shell\">&#8220;</span></span>.txt anagraficaLista_<span class=\"syntax--string syntax--quoted syntax--double syntax--shell\"><span class=\"syntax--punctuation syntax--definition syntax--string syntax--begin syntax--shell\">&#8220;</span><span class=\"syntax--variable syntax--other syntax--normal syntax--shell\"><span class=\"syntax--punctuation syntax--definition syntax--variable syntax--shell\">$</span>i</span><span class=\"syntax--punctuation syntax--definition syntax--string syntax--end syntax--shell\">&#8220;</span></span>.txt <span class=\"syntax--keyword syntax--operator syntax--redirect syntax--shell\">&gt;</span> lista_<span class=\"syntax--string syntax--quoted syntax--double syntax--shell\"><span class=\"syntax--punctuation syntax--definition syntax--string syntax--begin syntax--shell\">&#8220;</span><span class=\"syntax--variable syntax--other syntax--normal syntax--shell\"><span class=\"syntax--punctuation syntax--definition syntax--variable syntax--shell\">$</span>i</span><span class=\"syntax--punctuation syntax--definition syntax--string syntax--end syntax--shell\">&#8220;</span></span>.csv<span class=\"syntax--keyword syntax--operator syntax--list syntax--shell\">;</span> <span class=\"syntax--keyword syntax--control syntax--shell\">done</span></span></span></div>\n<div class=\"line\"><span class=\"syntax--source syntax--shell\"> </span></div>\n<div class=\"line\"><span class=\"syntax--source syntax--shell\"><span class=\"syntax--comment syntax--line syntax--number-sign syntax--shell\"><span class=\"syntax--punctuation syntax--definition syntax--comment syntax--shell\">#</span> faccio il merge di tutti i CSV e produco un unico file</span></span></div>\n<div class=\"line\"><span class=\"syntax--source syntax--shell\"><span class=\"syntax--comment syntax--line syntax--number-sign syntax--shell\"><span class=\"syntax--punctuation syntax--definition syntax--comment syntax--shell\">#</span> con tutti i voti per candidato per sezione di ogni lista</span></span></div>\n<div class=\"line\"><span class=\"syntax--source syntax--shell\">csvstack <span class=\"syntax--keyword syntax--operator syntax--glob syntax--shell\">*</span>.csv <span class=\"syntax--keyword syntax--operator syntax--pipe syntax--shell\">|</span> csvcut -c 1,2,3,4,6,8 <span class=\"syntax--keyword syntax--operator syntax--redirect syntax--shell\">&gt;</span> liste.csv</span></div>\n<div class=\"line\"><span class=\"syntax--source syntax--shell\"> </span></div>\n<div class=\"line\"><span class=\"syntax--source syntax--shell\"><span class=\"syntax--comment syntax--line syntax--number-sign syntax--shell\"><span class=\"syntax--punctuation syntax--definition syntax--comment syntax--shell\">#</span> cancello file che non mi sono più utili</span></span></div>\n<div class=\"line\"><span class=\"syntax--source syntax--shell\">rm -R <span class=\"syntax--keyword syntax--operator syntax--glob syntax--shell\">*</span>.txt</span></div>\n<div class=\"line\"><span class=\"syntax--source syntax--shell\">rm -R <span class=\"syntax--keyword syntax--operator syntax--glob syntax--shell\">*</span>.xml</span></div>\n<h2>Libro consigliato</h2>\n<p>Per entrare nel mondo divertentissimo ed efficiente della “riga di comando” mi sento di consigliare il bel “<a href=\"http://shop.oreilly.com/product/0636920032823.do?cmp=af-strata-books-videos-product_cj_9781491947852_%25zp\">Data Science at the Command Line</a>” . È un libro per tutti, di facile lettura e pieno di esempi utili.</p>\n<div class=\"sharedaddy sd-sharing-enabled\"><div class=\"robots-nocontent sd-block sd-social sd-social-icon sd-sharing\"><h3 class=\"sd-title\">Condividi:</h3><div class=\"sd-content\"><ul><li class=\"share-twitter\"><a rel=\"nofollow noopener noreferrer\" data-shared=\"sharing-twitter-1686\" class=\"share-twitter sd-button share-icon no-text\" href=\"/2017/06/16/leggere-interrogare-e-trasformare-file-xml-da-riga-di-comando/?share=twitter\" target=\"_blank\" title=\"Fai clic qui per condividere su Twitter\"><span></span><span class=\"sharing-screen-reader-text\">Fai clic qui per condividere su Twitter (Si apre in una nuova finestra)</span></a></li><li class=\"share-facebook\"><a rel=\"nofollow noopener noreferrer\" data-shared=\"sharing-facebook-1686\" class=\"share-facebook sd-button share-icon no-text\" href=\"/2017/06/16/leggere-interrogare-e-trasformare-file-xml-da-riga-di-comando/?share=facebook\" target=\"_blank\" title=\"Fai clic per condividere su Facebook\"><span></span><span class=\"sharing-screen-reader-text\">Fai clic per condividere su Facebook (Si apre in una nuova finestra)</span></a></li><li><a href=\"#\" class=\"sharing-anchor sd-button share-more\"><span>Altro</span></a></li><li class=\"share-end\"></li></ul><div class=\"sharing-hidden\"><div class=\"inner\" style=\"display: none;\"><ul><li class=\"share-linkedin\"><a rel=\"nofollow noopener noreferrer\" data-shared=\"sharing-linkedin-1686\" class=\"share-linkedin sd-button share-icon no-text\" href=\"/2017/06/16/leggere-interrogare-e-trasformare-file-xml-da-riga-di-comando/?share=linkedin\" target=\"_blank\" title=\"Fai clic qui per condividere su LinkedIn\"><span></span><span class=\"sharing-screen-reader-text\">Fai clic qui per condividere su LinkedIn (Si apre in una nuova finestra)</span></a></li><li class=\"share-telegram\"><a rel=\"nofollow noopener noreferrer\" data-shared=\"\" class=\"share-telegram sd-button share-icon no-text\" href=\"/2017/06/16/leggere-interrogare-e-trasformare-file-xml-da-riga-di-comando/?share=telegram\" target=\"_blank\" title=\"Fai clic per condividere su Telegram\"><span></span><span class=\"sharing-screen-reader-text\">Fai clic per condividere su Telegram (Si apre in una nuova finestra)</span></a></li><li class=\"share-end\"></li><li class=\"share-jetpack-whatsapp\"><a rel=\"nofollow noopener noreferrer\" data-shared=\"\" class=\"share-jetpack-whatsapp sd-button share-icon no-text\" href=\"/2017/06/16/leggere-interrogare-e-trasformare-file-xml-da-riga-di-comando/?share=jetpack-whatsapp\" target=\"_blank\" title=\"Fai clic per condividere su WhatsApp\"><span></span><span class=\"sharing-screen-reader-text\">Fai clic per condividere su WhatsApp (Si apre in una nuova finestra)</span></a></li><li class=\"share-end\"></li></ul></div></div></div></div></div>","date":"2017-06-16T12:27:28","author":{"node":{"name":"Andrea Borruso","slug":"andreaborruso"}},"comments":{"nodes":[{"content":"<p>Sinceramente utilizzo molto di più csvkit, per me è stato molto importante venirne a conoscenza. Molto.<br />\nXMLStarlet non ho avuto modo di testarlo nel mondo reale, purtroppo il mio background/skillset non mi permette approcciare in maniera immediata l&#8217;analisi dei dati o lo &#8220;scraping&#8221; (che é veramente dove voglio arrivare) e vado a passo lento ma costante. Una della mie principali mancanze è la impossibilità di raggionare con le regex e sapere pensare in XPATH, che anche se è certamente una cavolata (sopratutto XPATH) e bisognerebbe solo dedicarli un pochitino di tempo, quest&#8217;ultimo non so da dove tirarlo fuori. Senza grep/xpath non so dove mettere le mani.<br />\nPer adesso leggo e seguo con molto interese tutto quello che pubblicate e mi sto facendo il primer sulla command line su coursera. Se ci riesco mi ci metto serio con il libro &#8220;Data Science at The command line&#8221; questa estate, e forse a settembre ti racconterò una storia diversa.<br />\nUn bel po di roba da digerire per un Visual Designer wannabe. 😉</p>\n"},{"content":"<p>Roberto hai usato XMLstarlet? Che te ne pare?</p>\n"},{"content":"<p>Muchas Gracias 🙂</p>\n"}]},"categories":{"nodes":[{"name":"tutorial","slug":"tutorial"}]},"tags":{"nodes":[{"name":"bash","slug":"bash"},{"name":"elezioni","slug":"elezioni"},{"name":"palermo","slug":"palermo"},{"name":"xml","slug":"xml"}]},"featuredImage":null}]}},"pageContext":{"name":"bash","slug":"bash"}},
    "staticQueryHashes": ["67603594"]}