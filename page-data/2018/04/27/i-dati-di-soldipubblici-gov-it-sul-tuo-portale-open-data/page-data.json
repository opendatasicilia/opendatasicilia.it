{
    "componentChunkName": "component---src-templates-post-js",
    "path": "/2018/04/27/i-dati-di-soldipubblici-gov-it-sul-tuo-portale-open-data/",
    "result": {"data":{"allWpPost":{"nodes":[{"title":"I dati di soldipubblici.gov.it sul tuo portale open data","slug":"i-dati-di-soldipubblici-gov-it-sul-tuo-portale-open-data","uri":"/2018/04/27/i-dati-di-soldipubblici-gov-it-sul-tuo-portale-open-data/","excerpt":"<p>I portali open data hanno sempre bisogno di essere alimentati con dataset nuovi e soprattutto aggiornati.  Attivare quei meccanismi che consentono di generare file aperti e allo stesso aggiornati, nella Pubblica Amministrazione, è un processo che molte volte richiede tempo e soprattutto un cambio di mentalità; è un discorso questo, che si sente spesso nella [&hellip;]</p>\n<div class=\"sharedaddy sd-sharing-enabled\"><div class=\"robots-nocontent sd-block sd-social sd-social-icon sd-sharing\"><h3 class=\"sd-title\">Condividi:</h3><div class=\"sd-content\"><ul><li class=\"share-twitter\"><a rel=\"nofollow noopener noreferrer\" data-shared=\"sharing-twitter-1771\" class=\"share-twitter sd-button share-icon no-text\" href=\"/2018/04/27/i-dati-di-soldipubblici-gov-it-sul-tuo-portale-open-data/?share=twitter\" target=\"_blank\" title=\"Fai clic qui per condividere su Twitter\"><span></span><span class=\"sharing-screen-reader-text\">Fai clic qui per condividere su Twitter (Si apre in una nuova finestra)</span></a></li><li class=\"share-facebook\"><a rel=\"nofollow noopener noreferrer\" data-shared=\"sharing-facebook-1771\" class=\"share-facebook sd-button share-icon no-text\" href=\"/2018/04/27/i-dati-di-soldipubblici-gov-it-sul-tuo-portale-open-data/?share=facebook\" target=\"_blank\" title=\"Fai clic per condividere su Facebook\"><span></span><span class=\"sharing-screen-reader-text\">Fai clic per condividere su Facebook (Si apre in una nuova finestra)</span></a></li><li><a href=\"#\" class=\"sharing-anchor sd-button share-more\"><span>Altro</span></a></li><li class=\"share-end\"></li></ul><div class=\"sharing-hidden\"><div class=\"inner\" style=\"display: none;\"><ul><li class=\"share-linkedin\"><a rel=\"nofollow noopener noreferrer\" data-shared=\"sharing-linkedin-1771\" class=\"share-linkedin sd-button share-icon no-text\" href=\"/2018/04/27/i-dati-di-soldipubblici-gov-it-sul-tuo-portale-open-data/?share=linkedin\" target=\"_blank\" title=\"Fai clic qui per condividere su LinkedIn\"><span></span><span class=\"sharing-screen-reader-text\">Fai clic qui per condividere su LinkedIn (Si apre in una nuova finestra)</span></a></li><li class=\"share-telegram\"><a rel=\"nofollow noopener noreferrer\" data-shared=\"\" class=\"share-telegram sd-button share-icon no-text\" href=\"/2018/04/27/i-dati-di-soldipubblici-gov-it-sul-tuo-portale-open-data/?share=telegram\" target=\"_blank\" title=\"Fai clic per condividere su Telegram\"><span></span><span class=\"sharing-screen-reader-text\">Fai clic per condividere su Telegram (Si apre in una nuova finestra)</span></a></li><li class=\"share-end\"></li><li class=\"share-jetpack-whatsapp\"><a rel=\"nofollow noopener noreferrer\" data-shared=\"\" class=\"share-jetpack-whatsapp sd-button share-icon no-text\" href=\"/2018/04/27/i-dati-di-soldipubblici-gov-it-sul-tuo-portale-open-data/?share=jetpack-whatsapp\" target=\"_blank\" title=\"Fai clic per condividere su WhatsApp\"><span></span><span class=\"sharing-screen-reader-text\">Fai clic per condividere su WhatsApp (Si apre in una nuova finestra)</span></a></li><li class=\"share-end\"></li></ul></div></div></div></div></div>","content":"<p>I portali open data hanno sempre bisogno di essere alimentati con dataset nuovi e soprattutto aggiornati.  Attivare quei meccanismi che consentono di generare file aperti e allo stesso aggiornati, nella Pubblica Amministrazione, è un processo che molte volte richiede tempo e soprattutto un cambio di mentalità; è un discorso questo, che si sente spesso nella PA.</p>\n<p>La comunità di opendatasicilia mi ha spesso insegnato che, è mostrando la potenzialità dei dati aperti con il riuso, che quei meccanismi di interesse si possono sbloccare, attirando nuove idee e nuovi dati. Avere quindi dati aperti, aggiornati e attendibili, è cosa rara e complicata, ma quando ne puoi <a href=\"https://groups.google.com/d/msg/opendatasicilia/nzpMl2pXZqs/JulkbiDCCAAJ\">discutere un po’ in gruppo</a> e alimentare le tue fantasie e le tue idee con uno script di poche righe ma efficientissimo, allora la vita sembra prendere una piega del tutto diversa!</p>\n<p>Sotto la spinta delle mie esigenze lo script (creato da <a href=\"https://twitter.com/aborruso/\">Andrea Borruso</a>), originariamente nato per scaricare i dati di un singolo ente da <a href=\"http://soldipubblici.gov.it/\">soldipubblici.gov.it</a>, ha consentito la pubblicazione di una dataset sul portale open data della <a href=\"http://dati.cittametropolitana.na.it/dataset/soldipubblici-spese-correnti-della-citta-metropolitana-di-napoli\">Città Metropolitana di Napoli</a>, in due formati (csv e json), con aggiornamento automatico settimanale.</p>\n<p>Ma andiamo per gradi.<br />\nIl sito <a href=\"http://soldipubblici.gov.it/\">soldipubblici.gov.it</a> consente  di consultare e scaricare  i dati della spesa pubblica  ricercando un ente.</p>\n<p><img loading=\"lazy\" class=\"size-full wp-image-1773 alignnone\" src=\"https://i0.wp.com/opendatasicilia.it/wp-content/uploads/2018/04/soldipubblici.png?resize=1005%2C512&#038;ssl=1\" alt=\"\" width=\"1005\" height=\"512\" srcset=\"https://i0.wp.com/opendatasicilia.it/wp-content/uploads/2018/04/soldipubblici.png?w=1005&amp;ssl=1 1005w, https://i0.wp.com/opendatasicilia.it/wp-content/uploads/2018/04/soldipubblici.png?resize=300%2C153&amp;ssl=1 300w, https://i0.wp.com/opendatasicilia.it/wp-content/uploads/2018/04/soldipubblici.png?resize=768%2C391&amp;ssl=1 768w\" sizes=\"(max-width: 1005px) 100vw, 1005px\" data-recalc-dims=\"1\" /></p>\n<p>È possibile fare il download del CSV, al click su un pulsante, ma nel mio caso avevo bisogno di automatizzare questo processo.</p>\n<p>Lo script (accessibile <a href=\"https://gist.github.com/pablopers/a10e86987b2968f7460b21616842106f#file-gistfile1-txt-L36\">qui</a>) è scritto in bash, sfrutta le <em>utility</em> <a href=\"https://httpie.org/\">httpie</a>, <a href=\"https://stedolan.github.io/jq/\">jq</a> e <a href=\"https://csvkit.readthedocs.io\">csvkit</a> e funziona in questo modo:</p>\n<ul>\n<li>si imposta il codice dell’ente di interesse (i codici dei vari enti si trovano <a href=\"http://soldipubblici.gov.it/data/Siope-anagrafiche.zip\">qui</a>)</li>\n<li>il dato viene scaricato in formato JSON, e le cifre spese espresse in origine come numero intero (è stata rimossa la parte decimale, moltiplicando per 100), vengono riportate a numero decimale;</li>\n<li>il file così trasformato viene salvato in JSON e CSV.</li>\n</ul>\n<p>Alla versione originale dello script <a href=\"https://groups.google.com/d/msg/opendatasicilia/nzpMl2pXZqs/l9_1iSWGCgAJ\">volevo aggiungere</a> la possibilità di rimuovere quei record in cui le colonne con i valori numerici sono non valorizzate (sono “<i>null</i>”). E allora mi è stato suggerito di usare <a href=\"https://csvkit.readthedocs.io/en/1.0.3/scripts/csvgrep.html\">csvgrep</a>, che può filtrare le righe di una tabella a partire da un’espressione regolare ed è stata aggiunta la riga:</p>\n<pre class=\"\"><./input.csv csvgrep -c \"imp_uscite_att,importo_2013,importo_2014,importo_2015,importo_2016,importo_2017\" -r \"^$\" -i >./output.csv</pre>\n<p>Lo script viene eseguito su un server del mio Ente, e l’output è accessibile dall’esterno pubblicamente in http.</p>\n<p>Essendo i dati di “soldipubblici” aggiornati settimanalmente, nasceva infine l’esigenza di doverne automatizzare il download senza la necessità di un intervento umano. Così, sempre su indicazioni apprese nello scambio in mailing list, ho modificato il file /etc/crontab (che negli ambienti Linux consente di impostare delle operazioni da eseguire in modo pianificato) aggiungendo:</p>\n<pre class=\"\">0 4 */7 * * root /var/progetti/soldipubblici/getspscript.sh > /dev/null 2&1</pre>\n<p>La stringa “0 4 */7 * *” corrisponde a “<a href=\"https://crontab.guru/#0_4_*/7_*_*\">ogni 7 giorni alle 4 di mattina</a>”.</p>\n<p>Verificato che il tutto funzionasse correttamente e ottenuti i link statici dei file creati dallo script, ho provveduto a caricarli in un dataset sul portale ckan degli Open Data della Città Metropolitana di Napoli.</p>\n<p><img loading=\"lazy\" class=\"aligncenter size-full wp-image-1772\" src=\"https://i0.wp.com/opendatasicilia.it/wp-content/uploads/2018/04/portaleOpenDataCittaMetropolitanaNapoli.png?resize=946%2C732&#038;ssl=1\" alt=\"\" width=\"946\" height=\"732\" srcset=\"https://i0.wp.com/opendatasicilia.it/wp-content/uploads/2018/04/portaleOpenDataCittaMetropolitanaNapoli.png?w=946&amp;ssl=1 946w, https://i0.wp.com/opendatasicilia.it/wp-content/uploads/2018/04/portaleOpenDataCittaMetropolitanaNapoli.png?resize=300%2C232&amp;ssl=1 300w, https://i0.wp.com/opendatasicilia.it/wp-content/uploads/2018/04/portaleOpenDataCittaMetropolitanaNapoli.png?resize=768%2C594&amp;ssl=1 768w\" sizes=\"(max-width: 946px) 100vw, 946px\" data-recalc-dims=\"1\" /></p>\n<p>È nato così il primo caso d’uso specifico dello script SpesaCron, dove grazie all’estrazione di due file csv e json dai dati di <a href=\"http://soldipubblici.gov.it/\">soldipubblici.gov.it</a> è stato possibile pubblicare un dataset contenente tutte le voci di spesa di una Pubblica Amministrazione, automaticamente alimentato dallo stesso sito e con frequenza di aggiornamento settimanale.</p>\n<div class=\"sharedaddy sd-sharing-enabled\"><div class=\"robots-nocontent sd-block sd-social sd-social-icon sd-sharing\"><h3 class=\"sd-title\">Condividi:</h3><div class=\"sd-content\"><ul><li class=\"share-twitter\"><a rel=\"nofollow noopener noreferrer\" data-shared=\"sharing-twitter-1771\" class=\"share-twitter sd-button share-icon no-text\" href=\"/2018/04/27/i-dati-di-soldipubblici-gov-it-sul-tuo-portale-open-data/?share=twitter\" target=\"_blank\" title=\"Fai clic qui per condividere su Twitter\"><span></span><span class=\"sharing-screen-reader-text\">Fai clic qui per condividere su Twitter (Si apre in una nuova finestra)</span></a></li><li class=\"share-facebook\"><a rel=\"nofollow noopener noreferrer\" data-shared=\"sharing-facebook-1771\" class=\"share-facebook sd-button share-icon no-text\" href=\"/2018/04/27/i-dati-di-soldipubblici-gov-it-sul-tuo-portale-open-data/?share=facebook\" target=\"_blank\" title=\"Fai clic per condividere su Facebook\"><span></span><span class=\"sharing-screen-reader-text\">Fai clic per condividere su Facebook (Si apre in una nuova finestra)</span></a></li><li><a href=\"#\" class=\"sharing-anchor sd-button share-more\"><span>Altro</span></a></li><li class=\"share-end\"></li></ul><div class=\"sharing-hidden\"><div class=\"inner\" style=\"display: none;\"><ul><li class=\"share-linkedin\"><a rel=\"nofollow noopener noreferrer\" data-shared=\"sharing-linkedin-1771\" class=\"share-linkedin sd-button share-icon no-text\" href=\"/2018/04/27/i-dati-di-soldipubblici-gov-it-sul-tuo-portale-open-data/?share=linkedin\" target=\"_blank\" title=\"Fai clic qui per condividere su LinkedIn\"><span></span><span class=\"sharing-screen-reader-text\">Fai clic qui per condividere su LinkedIn (Si apre in una nuova finestra)</span></a></li><li class=\"share-telegram\"><a rel=\"nofollow noopener noreferrer\" data-shared=\"\" class=\"share-telegram sd-button share-icon no-text\" href=\"/2018/04/27/i-dati-di-soldipubblici-gov-it-sul-tuo-portale-open-data/?share=telegram\" target=\"_blank\" title=\"Fai clic per condividere su Telegram\"><span></span><span class=\"sharing-screen-reader-text\">Fai clic per condividere su Telegram (Si apre in una nuova finestra)</span></a></li><li class=\"share-end\"></li><li class=\"share-jetpack-whatsapp\"><a rel=\"nofollow noopener noreferrer\" data-shared=\"\" class=\"share-jetpack-whatsapp sd-button share-icon no-text\" href=\"/2018/04/27/i-dati-di-soldipubblici-gov-it-sul-tuo-portale-open-data/?share=jetpack-whatsapp\" target=\"_blank\" title=\"Fai clic per condividere su WhatsApp\"><span></span><span class=\"sharing-screen-reader-text\">Fai clic per condividere su WhatsApp (Si apre in una nuova finestra)</span></a></li><li class=\"share-end\"></li></ul></div></div></div></div></div>","date":"2018-04-27T08:15:16","author":{"node":{"name":"Pablo Persico","slug":"ppersico"}},"comments":{"nodes":[{"content":"<p>[&#8230;] I dati di soldipubblici.gov.it sul tuo portale open data [&#8230;]</p>\n"}]},"categories":{"nodes":[{"name":"Dati","slug":"dati"},{"name":"tools","slug":"tools"}]},"tags":{"nodes":[{"name":"bash","slug":"bash"},{"name":"script","slug":"script"}]},"featuredImage":null}]}},"pageContext":{"slug":"i-dati-di-soldipubblici-gov-it-sul-tuo-portale-open-data","uri":"/2018/04/27/i-dati-di-soldipubblici-gov-it-sul-tuo-portale-open-data/"}},
    "staticQueryHashes": ["67603594"]}